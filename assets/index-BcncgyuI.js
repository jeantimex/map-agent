(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function Yr(e,t){e.src=t}const Kr=e=>{var t,n,i,r="The Google Maps JavaScript API",s="google",o="importLibrary",a="__ib__",l=document,c=window,u=c[s]||(c[s]={}),h=u.maps||(u.maps={}),d=new Set,f=new URLSearchParams,p=()=>t||(t=new Promise(async(g,m)=>{await(n=l.createElement("script")),f.set("libraries",[...d]+"");for(i in e)f.set(i.replace(/[A-Z]/g,S=>"_"+S[0].toLowerCase()),e[i]);f.set("callback",s+".maps."+a),Yr(n,"https://maps.googleapis.com/maps/api/js?"+f),h[a]=g,n.onerror=()=>t=m(Error(r+" could not load.")),n.nonce=l.querySelector("script[nonce]")?.nonce||"",l.head.append(n)}));h[o]?console.warn(r+" only loads once. Ignoring:",e):h[o]=(g,...m)=>d.add(g)&&p().then(()=>h[o](g,...m))},Jr=e=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(e)}) will be ignored.`,Zr=e=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(e)}) will be ignored.`,Wr=()=>{},Xr=()=>{};let jt=!1;function jr(e){if(jt){Wr(Jr(e));return}Qr(e),jt=!0}async function he(e){if(!window?.google?.maps?.importLibrary)throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(e)}function Qr(e){const t=!!window.google?.maps?.importLibrary;t&&Xr(Zr(e)),t||Kr(e)}const ei="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%3e%3cpath%20d='M16%208.016A8.522%208.522%200%20008.016%2016h-.032A8.521%208.521%200%20000%208.016v-.032A8.521%208.521%200%20007.984%200h.032A8.522%208.522%200%200016%207.984v.032z'%20fill='url(%23prefix__paint0_radial_980_20147)'/%3e%3cdefs%3e%3cradialGradient%20id='prefix__paint0_radial_980_20147'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='matrix(16.1326%205.4553%20-43.70045%20129.2322%201.588%206.503)'%3e%3cstop%20offset='.067'%20stop-color='%239168C0'/%3e%3cstop%20offset='.343'%20stop-color='%235684D1'/%3e%3cstop%20offset='.672'%20stop-color='%231BA1E3'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";function ti(){const e=document.createElement("button");e.classList.add("agent-control"),e.title="Map Agent";const t=document.createElement("img");return t.src=ei,t.classList.add("agent-icon"),e.appendChild(t),e.addEventListener("click",()=>{const n=document.querySelector(".chat-container");n.classList.toggle("open"),n.classList.contains("open")&&setTimeout(()=>document.getElementById("chat-input").focus(),300)}),e}function At(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var te=At();function Vn(e){te=e}var ve={exec:()=>null};function w(e,t=""){let n=typeof e=="string"?e:e.source,i={replace:(r,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(_.caret,"$1"),n=n.replace(r,o),i},getRegex:()=>new RegExp(n,t)};return i}var ni=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),_={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},ri=/^(?:[ \t]*(?:\n|$))+/,ii=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,si=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ce=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,oi=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Mt=/(?:[*+-]|\d{1,9}[.)])/,Yn=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Kn=w(Yn).replace(/bull/g,Mt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ai=w(Yn).replace(/bull/g,Mt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Nt=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,li=/^[^\n]+/,$t=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,ci=w(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",$t).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),ui=w(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Mt).getRegex(),at="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ot=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,hi=w("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ot).replace("tag",at).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Jn=w(Nt).replace("hr",Ce).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",at).getRegex(),di=w(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Jn).getRegex(),Lt={blockquote:di,code:ii,def:ci,fences:si,heading:oi,hr:Ce,html:hi,lheading:Kn,list:ui,newline:ri,paragraph:Jn,table:ve,text:li},Qt=w("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ce).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",at).getRegex(),fi={...Lt,lheading:ai,table:Qt,paragraph:w(Nt).replace("hr",Ce).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Qt).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",at).getRegex()},pi={...Lt,html:w(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ot).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ve,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:w(Nt).replace("hr",Ce).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Kn).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},gi=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,mi=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Zn=/^( {2,}|\\)\n(?!\s*$)/,yi=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,lt=/[\p{P}\p{S}]/u,Bt=/[\s\p{P}\p{S}]/u,Wn=/[^\s\p{P}\p{S}]/u,wi=w(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Bt).getRegex(),Xn=/(?!~)[\p{P}\p{S}]/u,xi=/(?!~)[\s\p{P}\p{S}]/u,vi=/(?:[^\s\p{P}\p{S}]|~)/u,ki=w(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",ni?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),jn=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,bi=w(jn,"u").replace(/punct/g,lt).getRegex(),_i=w(jn,"u").replace(/punct/g,Xn).getRegex(),Qn="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Ei=w(Qn,"gu").replace(/notPunctSpace/g,Wn).replace(/punctSpace/g,Bt).replace(/punct/g,lt).getRegex(),Ti=w(Qn,"gu").replace(/notPunctSpace/g,vi).replace(/punctSpace/g,xi).replace(/punct/g,Xn).getRegex(),Si=w("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Wn).replace(/punctSpace/g,Bt).replace(/punct/g,lt).getRegex(),Ci=w(/\\(punct)/,"gu").replace(/punct/g,lt).getRegex(),Ri=w(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ii=w(Ot).replace("(?:-->|$)","-->").getRegex(),Ai=w("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ii).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Ye=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Mi=w(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Ye).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),er=w(/^!?\[(label)\]\[(ref)\]/).replace("label",Ye).replace("ref",$t).getRegex(),tr=w(/^!?\[(ref)\](?:\[\])?/).replace("ref",$t).getRegex(),Ni=w("reflink|nolink(?!\\()","g").replace("reflink",er).replace("nolink",tr).getRegex(),en=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Pt={_backpedal:ve,anyPunctuation:Ci,autolink:Ri,blockSkip:ki,br:Zn,code:mi,del:ve,emStrongLDelim:bi,emStrongRDelimAst:Ei,emStrongRDelimUnd:Si,escape:gi,link:Mi,nolink:tr,punctuation:wi,reflink:er,reflinkSearch:Ni,tag:Ai,text:yi,url:ve},$i={...Pt,link:w(/^!?\[(label)\]\((.*?)\)/).replace("label",Ye).getRegex(),reflink:w(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Ye).getRegex()},wt={...Pt,emStrongRDelimAst:Ti,emStrongLDelim:_i,url:w(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",en).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:w(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",en).getRegex()},Oi={...wt,br:w(Zn).replace("{2,}","*").getRegex(),text:w(wt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Oe={normal:Lt,gfm:fi,pedantic:pi},de={normal:Pt,gfm:wt,breaks:Oi,pedantic:$i},Li={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tn=e=>Li[e];function z(e,t){if(t){if(_.escapeTest.test(e))return e.replace(_.escapeReplace,tn)}else if(_.escapeTestNoEncode.test(e))return e.replace(_.escapeReplaceNoEncode,tn);return e}function nn(e){try{e=encodeURI(e).replace(_.percentDecode,"%")}catch{return null}return e}function rn(e,t){let n=e.replace(_.findPipe,(s,o,a)=>{let l=!1,c=o;for(;--c>=0&&a[c]==="\\";)l=!l;return l?"|":" |"}),i=n.split(_.splitPipe),r=0;if(i[0].trim()||i.shift(),i.length>0&&!i.at(-1)?.trim()&&i.pop(),t)if(i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;r<i.length;r++)i[r]=i[r].trim().replace(_.slashPipe,"|");return i}function fe(e,t,n){let i=e.length;if(i===0)return"";let r=0;for(;r<i&&e.charAt(i-r-1)===t;)r++;return e.slice(0,i-r)}function Bi(e,t){if(e.indexOf(t[1])===-1)return-1;let n=0;for(let i=0;i<e.length;i++)if(e[i]==="\\")i++;else if(e[i]===t[0])n++;else if(e[i]===t[1]&&(n--,n<0))return i;return n>0?-2:-1}function sn(e,t,n,i,r){let s=t.href,o=t.title||null,a=e[1].replace(r.other.outputLinkReplace,"$1");i.state.inLink=!0;let l={type:e[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:o,text:a,tokens:i.inlineTokens(a)};return i.state.inLink=!1,l}function Pi(e,t,n){let i=e.match(n.other.indentCodeCompensation);if(i===null)return t;let r=i[1];return t.split(`
`).map(s=>{let o=s.match(n.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=r.length?s.slice(r.length):s}).join(`
`)}var Ke=class{options;rules;lexer;constructor(e){this.options=e||te}space(e){let t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){let t=this.rules.block.code.exec(e);if(t){let n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:fe(n,`
`)}}}fences(e){let t=this.rules.block.fences.exec(e);if(t){let n=t[0],i=Pi(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:i}}}heading(e){let t=this.rules.block.heading.exec(e);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){let i=fe(n,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(n=i.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(e){let t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:fe(t[0],`
`)}}blockquote(e){let t=this.rules.block.blockquote.exec(e);if(t){let n=fe(t[0],`
`).split(`
`),i="",r="",s=[];for(;n.length>0;){let o=!1,a=[],l;for(l=0;l<n.length;l++)if(this.rules.other.blockquoteStart.test(n[l]))a.push(n[l]),o=!0;else if(!o)a.push(n[l]);else break;n=n.slice(l);let c=a.join(`
`),u=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${c}`:c,r=r?`${r}
${u}`:u;let h=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=h,n.length===0)break;let d=s.at(-1);if(d?.type==="code")break;if(d?.type==="blockquote"){let f=d,p=f.raw+`
`+n.join(`
`),g=this.blockquote(p);s[s.length-1]=g,i=i.substring(0,i.length-f.raw.length)+g.raw,r=r.substring(0,r.length-f.text.length)+g.text;break}else if(d?.type==="list"){let f=d,p=f.raw+`
`+n.join(`
`),g=this.list(p);s[s.length-1]=g,i=i.substring(0,i.length-d.raw.length)+g.raw,r=r.substring(0,r.length-f.raw.length)+g.raw,n=p.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:s,text:r}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim(),i=n.length>1,r={type:"list",raw:"",ordered:i,start:i?+n.slice(0,-1):"",loose:!1,items:[]};n=i?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=i?n:"[*+-]");let s=this.rules.other.listItemRegex(n),o=!1;for(;e;){let l=!1,c="",u="";if(!(t=s.exec(e))||this.rules.block.hr.test(e))break;c=t[0],e=e.substring(c.length);let h=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,g=>" ".repeat(3*g.length)),d=e.split(`
`,1)[0],f=!h.trim(),p=0;if(this.options.pedantic?(p=2,u=h.trimStart()):f?p=t[1].length+1:(p=t[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,u=h.slice(p),p+=t[1].length),f&&this.rules.other.blankLine.test(d)&&(c+=d+`
`,e=e.substring(d.length+1),l=!0),!l){let g=this.rules.other.nextBulletRegex(p),m=this.rules.other.hrRegex(p),S=this.rules.other.fencesBeginRegex(p),b=this.rules.other.headingBeginRegex(p),E=this.rules.other.htmlBeginRegex(p);for(;e;){let B=e.split(`
`,1)[0],v;if(d=B,this.options.pedantic?(d=d.replace(this.rules.other.listReplaceNesting,"  "),v=d):v=d.replace(this.rules.other.tabCharGlobal,"    "),S.test(d)||b.test(d)||E.test(d)||g.test(d)||m.test(d))break;if(v.search(this.rules.other.nonSpaceChar)>=p||!d.trim())u+=`
`+v.slice(p);else{if(f||h.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||S.test(h)||b.test(h)||m.test(h))break;u+=`
`+d}!f&&!d.trim()&&(f=!0),c+=B+`
`,e=e.substring(B.length+1),h=v.slice(p)}}r.loose||(o?r.loose=!0:this.rules.other.doubleBlankLine.test(c)&&(o=!0)),r.items.push({type:"list_item",raw:c,task:!!this.options.gfm&&this.rules.other.listIsTask.test(u),loose:!1,text:u,tokens:[]}),r.raw+=c}let a=r.items.at(-1);if(a)a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd();else return;r.raw=r.raw.trimEnd();for(let l of r.items){if(this.lexer.state.top=!1,l.tokens=this.lexer.blockTokens(l.text,[]),l.task){if(l.text=l.text.replace(this.rules.other.listReplaceTask,""),l.tokens[0]?.type==="text"||l.tokens[0]?.type==="paragraph"){l.tokens[0].raw=l.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),l.tokens[0].text=l.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let u=this.lexer.inlineQueue.length-1;u>=0;u--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[u].src)){this.lexer.inlineQueue[u].src=this.lexer.inlineQueue[u].src.replace(this.rules.other.listReplaceTask,"");break}}let c=this.rules.other.listTaskCheckbox.exec(l.raw);if(c){let u={type:"checkbox",raw:c[0]+" ",checked:c[0]!=="[ ]"};l.checked=u.checked,r.loose?l.tokens[0]&&["paragraph","text"].includes(l.tokens[0].type)&&"tokens"in l.tokens[0]&&l.tokens[0].tokens?(l.tokens[0].raw=u.raw+l.tokens[0].raw,l.tokens[0].text=u.raw+l.tokens[0].text,l.tokens[0].tokens.unshift(u)):l.tokens.unshift({type:"paragraph",raw:u.raw,text:u.raw,tokens:[u]}):l.tokens.unshift(u)}}if(!r.loose){let c=l.tokens.filter(h=>h.type==="space"),u=c.length>0&&c.some(h=>this.rules.other.anyLine.test(h.raw));r.loose=u}}if(r.loose)for(let l of r.items){l.loose=!0;for(let c of l.tokens)c.type==="text"&&(c.type="paragraph")}return r}}html(e){let t=this.rules.block.html.exec(e);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(e){let t=this.rules.block.def.exec(e);if(t){let n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:i,title:r}}}table(e){let t=this.rules.block.table.exec(e);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let n=rn(t[1]),i=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===i.length){for(let o of i)this.rules.other.tableAlignRight.test(o)?s.align.push("right"):this.rules.other.tableAlignCenter.test(o)?s.align.push("center"):this.rules.other.tableAlignLeft.test(o)?s.align.push("left"):s.align.push(null);for(let o=0;o<n.length;o++)s.header.push({text:n[o],tokens:this.lexer.inline(n[o]),header:!0,align:s.align[o]});for(let o of r)s.rows.push(rn(o,s.header.length).map((a,l)=>({text:a,tokens:this.lexer.inline(a),header:!1,align:s.align[l]})));return s}}lheading(e){let t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){let t=this.rules.block.paragraph.exec(e);if(t){let n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(e){let t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){let t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){let t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){let t=this.rules.inline.link.exec(e);if(t){let n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=fe(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=Bi(t[2],"()");if(s===-2)return;if(s>-1){let o=(t[0].indexOf("!")===0?5:4)+t[1].length+s;t[2]=t[2].substring(0,s),t[0]=t[0].substring(0,o).trim(),t[3]=""}}let i=t[2],r="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(i);s&&(i=s[1],r=s[3])}else r=t[3]?t[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?i=i.slice(1):i=i.slice(1,-1)),sn(t,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){let i=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),r=t[i.toLowerCase()];if(!r){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return sn(n,r,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let i=this.rules.inline.emStrongLDelim.exec(e);if(!(!i||i[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!n||this.rules.inline.punctuation.exec(n))){let r=[...i[0]].length-1,s,o,a=r,l=0,c=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,t=t.slice(-1*e.length+r);(i=c.exec(t))!=null;){if(s=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!s)continue;if(o=[...s].length,i[3]||i[4]){a+=o;continue}else if((i[5]||i[6])&&r%3&&!((r+o)%3)){l+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+l);let u=[...i[0]][0].length,h=e.slice(0,r+i.index+u+o);if(Math.min(r,o)%2){let f=h.slice(1,-1);return{type:"em",raw:h,text:f,tokens:this.lexer.inlineTokens(f)}}let d=h.slice(2,-2);return{type:"strong",raw:h,text:d,tokens:this.lexer.inlineTokens(d)}}}}codespan(e){let t=this.rules.inline.code.exec(e);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," "),i=this.rules.other.nonSpaceChar.test(n),r=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return i&&r&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(e){let t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){let t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){let t=this.rules.inline.autolink.exec(e);if(t){let n,i;return t[2]==="@"?(n=t[1],i="mailto:"+n):(n=t[1],i=n),{type:"link",raw:t[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let n,i;if(t[2]==="@")n=t[0],i="mailto:"+n;else{let r;do r=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(r!==t[0]);n=t[0],t[1]==="www."?i="http://"+t[0]:i=t[0]}return{type:"link",raw:t[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(e){let t=this.rules.inline.text.exec(e);if(t){let n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}},I=class xt{tokens;options;state;inlineQueue;tokenizer;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||te,this.options.tokenizer=this.options.tokenizer||new Ke,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:_,block:Oe.normal,inline:de.normal};this.options.pedantic?(n.block=Oe.pedantic,n.inline=de.pedantic):this.options.gfm&&(n.block=Oe.gfm,this.options.breaks?n.inline=de.breaks:n.inline=de.gfm),this.tokenizer.rules=n}static get rules(){return{block:Oe,inline:de}}static lex(t,n){return new xt(n).lex(t)}static lexInline(t,n){return new xt(n).inlineTokens(t)}lex(t){t=t.replace(_.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let i=this.inlineQueue[n];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[],i=!1){for(this.options.pedantic&&(t=t.replace(_.tabCharGlobal,"    ").replace(_.spaceLine,""));t;){let r;if(this.options.extensions?.block?.some(o=>(r=o.call({lexer:this},t,n))?(t=t.substring(r.raw.length),n.push(r),!0):!1))continue;if(r=this.tokenizer.space(t)){t=t.substring(r.raw.length);let o=n.at(-1);r.raw.length===1&&o!==void 0?o.raw+=`
`:n.push(r);continue}if(r=this.tokenizer.code(t)){t=t.substring(r.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+r.raw,o.text+=`
`+r.text,this.inlineQueue.at(-1).src=o.text):n.push(r);continue}if(r=this.tokenizer.fences(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.heading(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.hr(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.blockquote(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.list(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.html(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.def(t)){t=t.substring(r.raw.length);let o=n.at(-1);o?.type==="paragraph"||o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+r.raw,o.text+=`
`+r.raw,this.inlineQueue.at(-1).src=o.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title},n.push(r));continue}if(r=this.tokenizer.table(t)){t=t.substring(r.raw.length),n.push(r);continue}if(r=this.tokenizer.lheading(t)){t=t.substring(r.raw.length),n.push(r);continue}let s=t;if(this.options.extensions?.startBlock){let o=1/0,a=t.slice(1),l;this.options.extensions.startBlock.forEach(c=>{l=c.call({lexer:this},a),typeof l=="number"&&l>=0&&(o=Math.min(o,l))}),o<1/0&&o>=0&&(s=t.substring(0,o+1))}if(this.state.top&&(r=this.tokenizer.paragraph(s))){let o=n.at(-1);i&&o?.type==="paragraph"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+r.raw,o.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(r),i=s.length!==t.length,t=t.substring(r.raw.length);continue}if(r=this.tokenizer.text(t)){t=t.substring(r.raw.length);let o=n.at(-1);o?.type==="text"?(o.raw+=(o.raw.endsWith(`
`)?"":`
`)+r.raw,o.text+=`
`+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):n.push(r);continue}if(t){let o="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(o);break}else throw new Error(o)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){let i=t,r=null;if(this.tokens.links){let l=Object.keys(this.tokens.links);if(l.length>0)for(;(r=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)l.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(r=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,r.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(r=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)s=r[2]?r[2].length:0,i=i.slice(0,r.index+s)+"["+"a".repeat(r[0].length-s-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);i=this.options.hooks?.emStrongMask?.call({lexer:this},i)??i;let o=!1,a="";for(;t;){o||(a=""),o=!1;let l;if(this.options.extensions?.inline?.some(u=>(l=u.call({lexer:this},t,n))?(t=t.substring(l.raw.length),n.push(l),!0):!1))continue;if(l=this.tokenizer.escape(t)){t=t.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.tag(t)){t=t.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.link(t)){t=t.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(l.raw.length);let u=n.at(-1);l.type==="text"&&u?.type==="text"?(u.raw+=l.raw,u.text+=l.text):n.push(l);continue}if(l=this.tokenizer.emStrong(t,i,a)){t=t.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.codespan(t)){t=t.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.br(t)){t=t.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.del(t)){t=t.substring(l.raw.length),n.push(l);continue}if(l=this.tokenizer.autolink(t)){t=t.substring(l.raw.length),n.push(l);continue}if(!this.state.inLink&&(l=this.tokenizer.url(t))){t=t.substring(l.raw.length),n.push(l);continue}let c=t;if(this.options.extensions?.startInline){let u=1/0,h=t.slice(1),d;this.options.extensions.startInline.forEach(f=>{d=f.call({lexer:this},h),typeof d=="number"&&d>=0&&(u=Math.min(u,d))}),u<1/0&&u>=0&&(c=t.substring(0,u+1))}if(l=this.tokenizer.inlineText(c)){t=t.substring(l.raw.length),l.raw.slice(-1)!=="_"&&(a=l.raw.slice(-1)),o=!0;let u=n.at(-1);u?.type==="text"?(u.raw+=l.raw,u.text+=l.text):n.push(l);continue}if(t){let u="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return n}},Je=class{options;parser;constructor(e){this.options=e||te}space(e){return""}code({text:e,lang:t,escaped:n}){let i=(t||"").match(_.notSpaceStart)?.[0],r=e.replace(_.endingNewline,"")+`
`;return i?'<pre><code class="language-'+z(i)+'">'+(n?r:z(r,!0))+`</code></pre>
`:"<pre><code>"+(n?r:z(r,!0))+`</code></pre>
`}blockquote({tokens:e}){return`<blockquote>
${this.parser.parse(e)}</blockquote>
`}html({text:e}){return e}def(e){return""}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>
`}hr(e){return`<hr>
`}list(e){let t=e.ordered,n=e.start,i="";for(let o=0;o<e.items.length;o++){let a=e.items[o];i+=this.listitem(a)}let r=t?"ol":"ul",s=t&&n!==1?' start="'+n+'"':"";return"<"+r+s+`>
`+i+"</"+r+`>
`}listitem(e){return`<li>${this.parser.parse(e.tokens)}</li>
`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>
`}table(e){let t="",n="";for(let r=0;r<e.header.length;r++)n+=this.tablecell(e.header[r]);t+=this.tablerow({text:n});let i="";for(let r=0;r<e.rows.length;r++){let s=e.rows[r];n="";for(let o=0;o<s.length;o++)n+=this.tablecell(s[o]);i+=this.tablerow({text:n})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+i+`</table>
`}tablerow({text:e}){return`<tr>
${e}</tr>
`}tablecell(e){let t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${z(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){let i=this.parser.parseInline(n),r=nn(e);if(r===null)return i;e=r;let s='<a href="'+e+'"';return t&&(s+=' title="'+z(t)+'"'),s+=">"+i+"</a>",s}image({href:e,title:t,text:n,tokens:i}){i&&(n=this.parser.parseInline(i,this.parser.textRenderer));let r=nn(e);if(r===null)return z(n);e=r;let s=`<img src="${e}" alt="${n}"`;return t&&(s+=` title="${z(t)}"`),s+=">",s}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:z(e.text)}},Dt=class{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}checkbox({raw:e}){return e}},A=class vt{options;renderer;textRenderer;constructor(t){this.options=t||te,this.options.renderer=this.options.renderer||new Je,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Dt}static parse(t,n){return new vt(n).parse(t)}static parseInline(t,n){return new vt(n).parseInline(t)}parse(t){let n="";for(let i=0;i<t.length;i++){let r=t[i];if(this.options.extensions?.renderers?.[r.type]){let o=r,a=this.options.extensions.renderers[o.type].call({parser:this},o);if(a!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(o.type)){n+=a||"";continue}}let s=r;switch(s.type){case"space":{n+=this.renderer.space(s);break}case"hr":{n+=this.renderer.hr(s);break}case"heading":{n+=this.renderer.heading(s);break}case"code":{n+=this.renderer.code(s);break}case"table":{n+=this.renderer.table(s);break}case"blockquote":{n+=this.renderer.blockquote(s);break}case"list":{n+=this.renderer.list(s);break}case"checkbox":{n+=this.renderer.checkbox(s);break}case"html":{n+=this.renderer.html(s);break}case"def":{n+=this.renderer.def(s);break}case"paragraph":{n+=this.renderer.paragraph(s);break}case"text":{n+=this.renderer.text(s);break}default:{let o='Token with "'+s.type+'" type was not found.';if(this.options.silent)return console.error(o),"";throw new Error(o)}}}return n}parseInline(t,n=this.renderer){let i="";for(let r=0;r<t.length;r++){let s=t[r];if(this.options.extensions?.renderers?.[s.type]){let a=this.options.extensions.renderers[s.type].call({parser:this},s);if(a!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(s.type)){i+=a||"";continue}}let o=s;switch(o.type){case"escape":{i+=n.text(o);break}case"html":{i+=n.html(o);break}case"link":{i+=n.link(o);break}case"image":{i+=n.image(o);break}case"checkbox":{i+=n.checkbox(o);break}case"strong":{i+=n.strong(o);break}case"em":{i+=n.em(o);break}case"codespan":{i+=n.codespan(o);break}case"br":{i+=n.br(o);break}case"del":{i+=n.del(o);break}case"text":{i+=n.text(o);break}default:{let a='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return i}},me=class{options;block;constructor(e){this.options=e||te}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}emStrongMask(e){return e}provideLexer(){return this.block?I.lex:I.lexInline}provideParser(){return this.block?A.parse:A.parseInline}},Di=class{defaults=At();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=A;Renderer=Je;TextRenderer=Dt;Lexer=I;Tokenizer=Ke;Hooks=me;constructor(...e){this.use(...e)}walkTokens(e,t){let n=[];for(let i of e)switch(n=n.concat(t.call(this,i)),i.type){case"table":{let r=i;for(let s of r.header)n=n.concat(this.walkTokens(s.tokens,t));for(let s of r.rows)for(let o of s)n=n.concat(this.walkTokens(o.tokens,t));break}case"list":{let r=i;n=n.concat(this.walkTokens(r.items,t));break}default:{let r=i;this.defaults.extensions?.childTokens?.[r.type]?this.defaults.extensions.childTokens[r.type].forEach(s=>{let o=r[s].flat(1/0);n=n.concat(this.walkTokens(o,t))}):r.tokens&&(n=n.concat(this.walkTokens(r.tokens,t)))}}return n}use(...e){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach(n=>{let i={...n};if(i.async=this.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){let s=t.renderers[r.name];s?t.renderers[r.name]=function(...o){let a=r.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:t.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=t[r.level];s?s.unshift(r.tokenizer):t[r.level]=[r.tokenizer],r.start&&(r.level==="block"?t.startBlock?t.startBlock.push(r.start):t.startBlock=[r.start]:r.level==="inline"&&(t.startInline?t.startInline.push(r.start):t.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(t.childTokens[r.name]=r.childTokens)}),i.extensions=t),n.renderer){let r=this.defaults.renderer||new Je(this.defaults);for(let s in n.renderer){if(!(s in r))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=n.renderer[o],l=r[o];r[o]=(...c)=>{let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u||""}}i.renderer=r}if(n.tokenizer){let r=this.defaults.tokenizer||new Ke(this.defaults);for(let s in n.tokenizer){if(!(s in r))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=n.tokenizer[o],l=r[o];r[o]=(...c)=>{let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u}}i.tokenizer=r}if(n.hooks){let r=this.defaults.hooks||new me;for(let s in n.hooks){if(!(s in r))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=n.hooks[o],l=r[o];me.passThroughHooks.has(s)?r[o]=c=>{if(this.defaults.async&&me.passThroughHooksRespectAsync.has(s))return(async()=>{let h=await a.call(r,c);return l.call(r,h)})();let u=a.call(r,c);return l.call(r,u)}:r[o]=(...c)=>{if(this.defaults.async)return(async()=>{let h=await a.apply(r,c);return h===!1&&(h=await l.apply(r,c)),h})();let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u}}i.hooks=r}if(n.walkTokens){let r=this.defaults.walkTokens,s=n.walkTokens;i.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),r&&(a=a.concat(r.call(this,o))),a}}this.defaults={...this.defaults,...i}}),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return I.lex(e,t??this.defaults)}parser(e,t){return A.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{let i={...n},r={...this.defaults,...i},s=this.onError(!!r.silent,!!r.async);if(this.defaults.async===!0&&i.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(r.hooks&&(r.hooks.options=r,r.hooks.block=e),r.async)return(async()=>{let o=r.hooks?await r.hooks.preprocess(t):t,a=await(r.hooks?await r.hooks.provideLexer():e?I.lex:I.lexInline)(o,r),l=r.hooks?await r.hooks.processAllTokens(a):a;r.walkTokens&&await Promise.all(this.walkTokens(l,r.walkTokens));let c=await(r.hooks?await r.hooks.provideParser():e?A.parse:A.parseInline)(l,r);return r.hooks?await r.hooks.postprocess(c):c})().catch(s);try{r.hooks&&(t=r.hooks.preprocess(t));let o=(r.hooks?r.hooks.provideLexer():e?I.lex:I.lexInline)(t,r);r.hooks&&(o=r.hooks.processAllTokens(o)),r.walkTokens&&this.walkTokens(o,r.walkTokens);let a=(r.hooks?r.hooks.provideParser():e?A.parse:A.parseInline)(o,r);return r.hooks&&(a=r.hooks.postprocess(a)),a}catch(o){return s(o)}}}onError(e,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,e){let i="<p>An error occurred:</p><pre>"+z(n.message+"",!0)+"</pre>";return t?Promise.resolve(i):i}if(t)return Promise.reject(n);throw n}}},X=new Di;function x(e,t){return X.parse(e,t)}x.options=x.setOptions=function(e){return X.setOptions(e),x.defaults=X.defaults,Vn(x.defaults),x};x.getDefaults=At;x.defaults=te;x.use=function(...e){return X.use(...e),x.defaults=X.defaults,Vn(x.defaults),x};x.walkTokens=function(e,t){return X.walkTokens(e,t)};x.parseInline=X.parseInline;x.Parser=A;x.parser=A.parse;x.Renderer=Je;x.TextRenderer=Dt;x.Lexer=I;x.lexer=I.lex;x.Tokenizer=Ke;x.Hooks=me;x.parse=x;x.options;x.setOptions;x.use;x.walkTokens;x.parseInline;A.parse;I.lex;function zi(e){const t=document.getElementById("chat-input"),n=document.getElementById("action-btn"),i=n.querySelector("span");let r,s=!1;const o=()=>{t.style.height="auto",t.style.height=t.scrollHeight+"px"};if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const u=window.SpeechRecognition||window.webkitSpeechRecognition;r=new u,r.continuous=!0,r.interimResults=!0,r.lang="en-US",r.onstart=()=>{s=!0,n.classList.add("listening"),i.textContent="stop",t.placeholder="Listening..."},r.onresult=h=>{let d="";for(let f=0;f<h.results.length;f++)d+=h.results[f][0].transcript;t.value=d,o(),a()},r.onend=()=>{s=!1,n.classList.remove("listening"),t.placeholder="Type a message...",a()},r.onerror=h=>{console.error("Speech recognition error",h.error),s=!1,n.classList.remove("listening"),a()}}else console.warn("Web Speech API not supported."),i.textContent="send";function a(){s||(t.value.trim().length>0?(n.classList.add("send"),i.textContent="send"):(n.classList.remove("send"),i.textContent="mic"))}function l(){if(s){r.stop();return}if(t.value.trim().length>0){c();return}r&&r.start()}function c(){const u=t.value.trim();u&&(G(u,!0),t.value="",t.style.height="auto",t.disabled=!0,a(),e(u).finally(()=>{t.disabled=!1,t.focus(),a()}))}n.addEventListener("click",l),t.addEventListener("input",()=>{o(),a()}),t.addEventListener("keydown",u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),c())}),document.getElementById("close-chat").addEventListener("click",()=>{document.querySelector(".chat-container").classList.remove("open")})}function G(e,t=!1){if(!e||!e.trim())return;const n=document.getElementById("chat-messages"),i=document.createElement("div");i.className=`message ${t?"user":"system"}`,t?i.textContent=e:i.innerHTML=x.parse(e),n.appendChild(i),n.scrollTop=n.scrollHeight}const qi="AIzaSyBEyMHI6C2bjOCRLnXexUgGs4e1U8bPY3I";jr({key:qi,v:"weekly",libraries:["maps","geocoding","streetView","places"]});async function Gi(){const e=document.getElementById("map");if(!e)return null;try{const{Map:t}=await he("maps"),{Geocoder:n}=await he("geocoding"),{StreetViewPanorama:i}=await he("streetView");await he("places"),await he("marker");const r={lat:37.7749,lng:-122.4194},s=new n,o=new google.maps.DirectionsService,a=new google.maps.ElevationService,l=new t(e,{center:r,zoom:12,renderingType:"VECTOR",disableDefaultUI:!0,streetViewControl:!0,tiltInteractionEnabled:!0,headingInteractionEnabled:!0,gestureHandling:"greedy",mapId:"DEMO_MAP_ID"}),c=new i(document.getElementById("pano"),{position:r,visible:!1,pov:{heading:0,pitch:0}});c.addListener("status_changed",()=>{const d=c.getStatus(),f=document.getElementById("pano");let p=document.getElementById("pano-error");d==="ZERO_RESULTS"?(p||(p=document.createElement("div"),p.id="pano-error",p.innerText="Streetview is not available for the current address",Object.assign(p.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",padding:"10px 20px",borderRadius:"5px",zIndex:"10",pointerEvents:"none"}),f.appendChild(p)),p.style.display="block"):d==="OK"&&p&&(p.style.display="none")});const u=ti(l);l.controls[google.maps.ControlPosition.INLINE_END_BLOCK_END].push(u),l.addListener("click",()=>{document.querySelector(".chat-container").classList.remove("open")});let h;return l.addListener("center_changed",()=>{clearTimeout(h),h=setTimeout(()=>{c.setPosition(l.getCenter()),document.getElementById("map-container").classList.contains("split-view")&&c.setVisible(!0)},500)}),{map:l,geocoder:s,panorama:c,directionsService:o,elevationService:a}}catch(t){return console.error("Error loading Google Maps API:",t),G("Error loading Maps. Please check your API key.",!1),null}}var on;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(on||(on={}));var an;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(an||(an={}));var ln;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(ln||(ln={}));const cn=["user","model","function","system"];var un;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(un||(un={}));var hn;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(hn||(hn={}));var dn;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(dn||(dn={}));var fn;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(fn||(fn={}));var ke;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(ke||(ke={}));var pn;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(pn||(pn={}));var gn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(gn||(gn={}));var mn;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(mn||(mn={}));class k extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class re extends k{constructor(t,n){super(t),this.response=n}}class nr extends k{constructor(t,n,i,r){super(t),this.status=n,this.statusText=i,this.errorDetails=r}}class F extends k{}class rr extends k{}const Ui="https://generativelanguage.googleapis.com",Hi="v1beta",Fi="0.24.1",Vi="genai-js";var j;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(j||(j={}));class Yi{constructor(t,n,i,r,s){this.model=t,this.task=n,this.apiKey=i,this.stream=r,this.requestOptions=s}toString(){var t,n;const i=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||Hi;let s=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Ui}/${i}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}function Ki(e){const t=[];return e?.apiClient&&t.push(e.apiClient),t.push(`${Vi}/${Fi}`),t.join(" ")}async function Ji(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",Ki(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let i=(t=e.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(r){throw new F(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${r.message}`)}for(const[r,s]of i.entries()){if(r==="x-goog-api-key")throw new F(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new F(`Header name ${r} can only be set using the apiClient field`);n.append(r,s)}}return n}async function Zi(e,t,n,i,r,s){const o=new Yi(e,t,n,i,s);return{url:o.toString(),fetchOptions:Object.assign(Object.assign({},Qi(s)),{method:"POST",headers:await Ji(o),body:r})}}async function Re(e,t,n,i,r,s={},o=fetch){const{url:a,fetchOptions:l}=await Zi(e,t,n,i,r,s);return Wi(a,l,o)}async function Wi(e,t,n=fetch){let i;try{i=await n(e,t)}catch(r){Xi(r,e)}return i.ok||await ji(i,e),i}function Xi(e,t){let n=e;throw n.name==="AbortError"?(n=new rr(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof nr||e instanceof F||(n=new k(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack),n}async function ji(e,t){let n="",i;try{const r=await e.json();n=r.error.message,r.error.details&&(n+=` ${JSON.stringify(r.error.details)}`,i=r.error.details)}catch{}throw new nr(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,i)}function Qi(e){const t={};if(e?.signal!==void 0||e?.timeout>=0){const n=new AbortController;e?.timeout>=0&&setTimeout(()=>n.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}function zt(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),qe(e.candidates[0]))throw new re(`${H(e)}`,e);return es(e)}else if(e.promptFeedback)throw new re(`Text not available. ${H(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),qe(e.candidates[0]))throw new re(`${H(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),yn(e)[0]}else if(e.promptFeedback)throw new re(`Function call not available. ${H(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),qe(e.candidates[0]))throw new re(`${H(e)}`,e);return yn(e)}else if(e.promptFeedback)throw new re(`Function call not available. ${H(e)}`,e)},e}function es(e){var t,n,i,r;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const o of(r=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)o.text&&s.push(o.text),o.executableCode&&s.push("\n```"+o.executableCode.language+`
`+o.executableCode.code+"\n```\n"),o.codeExecutionResult&&s.push("\n```\n"+o.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function yn(e){var t,n,i,r;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const o of(r=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||r===void 0?void 0:r.parts)o.functionCall&&s.push(o.functionCall);if(s.length>0)return s}const ts=[ke.RECITATION,ke.SAFETY,ke.LANGUAGE];function qe(e){return!!e.finishReason&&ts.includes(e.finishReason)}function H(e){var t,n,i;let r="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)r+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(r+=` due to ${e.promptFeedback.blockReason}`),!((n=e.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(r+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((i=e.candidates)===null||i===void 0)&&i[0]){const s=e.candidates[0];qe(s)&&(r+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(r+=`: ${s.finishMessage}`))}return r}function be(e){return this instanceof be?(this.v=e,this):new be(e)}function ns(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(e,t||[]),r,s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(d){i[d]&&(r[d]=function(f){return new Promise(function(p,g){s.push([d,f,p,g])>1||a(d,f)})})}function a(d,f){try{l(i[d](f))}catch(p){h(s[0][3],p)}}function l(d){d.value instanceof be?Promise.resolve(d.value.v).then(c,u):h(s[0][2],d)}function c(d){a("next",d)}function u(d){a("throw",d)}function h(d,f){d(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}const wn=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function rs(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=os(t),[i,r]=n.tee();return{stream:ss(i),response:is(r)}}async function is(e){const t=[],n=e.getReader();for(;;){const{done:i,value:r}=await n.read();if(i)return zt(as(t));t.push(r)}}function ss(e){return ns(this,arguments,function*(){const n=e.getReader();for(;;){const{value:i,done:r}=yield be(n.read());if(r)break;yield yield be(zt(i))}})}function os(e){const t=e.getReader();return new ReadableStream({start(i){let r="";return s();function s(){return t.read().then(({value:o,done:a})=>{if(a){if(r.trim()){i.error(new k("Failed to parse stream"));return}i.close();return}r+=o;let l=r.match(wn),c;for(;l;){try{c=JSON.parse(l[1])}catch{i.error(new k(`Error parsing JSON response: "${l[1]}"`));return}i.enqueue(c),r=r.substring(l[0].length),l=r.match(wn)}return s()}).catch(o=>{let a=o;throw a.stack=o.stack,a.name==="AbortError"?a=new rr("Request aborted when reading from the stream"):a=new k("Error reading from the stream"),a})}}})}function as(e){const t=e[e.length-1],n={promptFeedback:t?.promptFeedback};for(const i of e){if(i.candidates){let r=0;for(const s of i.candidates)if(n.candidates||(n.candidates=[]),n.candidates[r]||(n.candidates[r]={index:r}),n.candidates[r].citationMetadata=s.citationMetadata,n.candidates[r].groundingMetadata=s.groundingMetadata,n.candidates[r].finishReason=s.finishReason,n.candidates[r].finishMessage=s.finishMessage,n.candidates[r].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[r].content||(n.candidates[r].content={role:s.content.role||"user",parts:[]});const o={};for(const a of s.content.parts)a.text&&(o.text=a.text),a.functionCall&&(o.functionCall=a.functionCall),a.executableCode&&(o.executableCode=a.executableCode),a.codeExecutionResult&&(o.codeExecutionResult=a.codeExecutionResult),Object.keys(o).length===0&&(o.text=""),n.candidates[r].content.parts.push(o)}r++}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}async function ir(e,t,n,i){const r=await Re(t,j.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),i);return rs(r)}async function sr(e,t,n,i){const s=await(await Re(t,j.GENERATE_CONTENT,e,!1,JSON.stringify(n),i)).json();return{response:zt(s)}}function or(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function _e(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const n of e)typeof n=="string"?t.push({text:n}):t.push(n);return ls(t)}function ls(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,r=!1;for(const s of e)"functionResponse"in s?(n.parts.push(s),r=!0):(t.parts.push(s),i=!0);if(i&&r)throw new k("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!r)throw new k("No content is provided for sending chat message.");return i?t:n}function cs(e,t){var n;let i={model:t?.model,generationConfig:t?.generationConfig,safetySettings:t?.safetySettings,tools:t?.tools,toolConfig:t?.toolConfig,systemInstruction:t?.systemInstruction,cachedContent:(n=t?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const r=e.generateContentRequest!=null;if(e.contents){if(r)throw new F("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(r)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{const s=_e(e);i.contents=[s]}return{generateContentRequest:i}}function xn(e){let t;return e.contents?t=e:t={contents:[_e(e)]},e.systemInstruction&&(t.systemInstruction=or(e.systemInstruction)),t}function us(e){return typeof e=="string"||Array.isArray(e)?{content:_e(e)}:e}const vn=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],hs={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function ds(e){let t=!1;for(const n of e){const{role:i,parts:r}=n;if(!t&&i!=="user")throw new k(`First content should be with role 'user', got ${i}`);if(!cn.includes(i))throw new k(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify(cn)}`);if(!Array.isArray(r))throw new k("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new k("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of r)for(const l of vn)l in a&&(s[l]+=1);const o=hs[i];for(const a of vn)if(!o.includes(a)&&s[a]>0)throw new k(`Content with role '${i}' can't contain '${a}' part`);t=!0}}function kn(e){var t;if(e.candidates===void 0||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const i of n.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}const bn="SILENT_ERROR";class fs{constructor(t,n,i,r={}){this.model=n,this.params=i,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,i?.history&&(ds(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,n={}){var i,r,s,o,a,l;await this._sendPromise;const c=_e(t),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},h=Object.assign(Object.assign({},this._requestOptions),n);let d;return this._sendPromise=this._sendPromise.then(()=>sr(this._apiKey,this.model,u,h)).then(f=>{var p;if(kn(f.response)){this._history.push(c);const g=Object.assign({parts:[],role:"model"},(p=f.response.candidates)===null||p===void 0?void 0:p[0].content);this._history.push(g)}else{const g=H(f.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}d=f}).catch(f=>{throw this._sendPromise=Promise.resolve(),f}),await this._sendPromise,d}async sendMessageStream(t,n={}){var i,r,s,o,a,l;await this._sendPromise;const c=_e(t),u={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(o=this.params)===null||o===void 0?void 0:o.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},h=Object.assign(Object.assign({},this._requestOptions),n),d=ir(this._apiKey,this.model,u,h);return this._sendPromise=this._sendPromise.then(()=>d).catch(f=>{throw new Error(bn)}).then(f=>f.response).then(f=>{if(kn(f)){this._history.push(c);const p=Object.assign({},f.candidates[0].content);p.role||(p.role="model"),this._history.push(p)}else{const p=H(f);p&&console.warn(`sendMessageStream() was unsuccessful. ${p}. Inspect response object for details.`)}}).catch(f=>{f.message!==bn&&console.error(f)}),d}}async function ps(e,t,n,i){return(await Re(t,j.COUNT_TOKENS,e,!1,JSON.stringify(n),i)).json()}async function gs(e,t,n,i){return(await Re(t,j.EMBED_CONTENT,e,!1,JSON.stringify(n),i)).json()}async function ms(e,t,n,i){const r=n.requests.map(o=>Object.assign(Object.assign({},o),{model:t}));return(await Re(t,j.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:r}),i)).json()}class _n{constructor(t,n,i={}){this.apiKey=t,this._requestOptions=i,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=or(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(t,n={}){var i;const r=xn(t),s=Object.assign(Object.assign({},this._requestOptions),n);return sr(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),s)}async generateContentStream(t,n={}){var i;const r=xn(t),s=Object.assign(Object.assign({},this._requestOptions),n);return ir(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},r),s)}startChat(t){var n;return new fs(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},t),this._requestOptions)}async countTokens(t,n={}){const i=cs(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),n);return ps(this.apiKey,this.model,i,r)}async embedContent(t,n={}){const i=us(t),r=Object.assign(Object.assign({},this._requestOptions),n);return gs(this.apiKey,this.model,i,r)}async batchEmbedContents(t,n={}){const i=Object.assign(Object.assign({},this._requestOptions),n);return ms(this.apiKey,this.model,t,i)}}class ys{constructor(t){this.apiKey=t}getGenerativeModel(t,n){if(!t.model)throw new k("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new _n(this.apiKey,t,n)}getGenerativeModelFromCachedContent(t,n,i){if(!t.name)throw new F("Cached content must contain a `name` field.");if(!t.model)throw new F("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const o of r)if(n?.[o]&&t[o]&&n?.[o]!==t[o]){if(o==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(a===l)continue}throw new F(`Different value for "${o}" specified in modelParams (${n[o]}) and cachedContent (${t[o]})`)}const s=Object.assign(Object.assign({},n),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new _n(this.apiKey,s,i)}}const ar=[{name:"panToLocation",description:"Moves the map view to a specific address, city, landmark, or location name. Use this for navigation commands like 'Go to X', 'Fly to Y', 'Show me Z'. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{locationName:{type:"STRING",description:"The name of the city, address, or landmark."}},required:["locationName"]}},{name:"panToCoordinates",description:"Moves the map center to specific latitude and longitude coordinates using smooth animation. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{lat:{type:"NUMBER",description:"The latitude"},lng:{type:"NUMBER",description:"The longitude"}},required:["lat","lng"]}},{name:"setCenter",description:"Immediately sets the map center to specific latitude and longitude coordinates (no animation). This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{lat:{type:"NUMBER",description:"The latitude"},lng:{type:"NUMBER",description:"The longitude"}},required:["lat","lng"]}},{name:"panToBounds",description:"Pans the map to contain the given bounds (south, west, north, east). Zoom is NOT changed. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{south:{type:"NUMBER",description:"Southern latitude"},west:{type:"NUMBER",description:"Western longitude"},north:{type:"NUMBER",description:"Northern latitude"},east:{type:"NUMBER",description:"Eastern longitude"},padding:{type:"NUMBER",description:"Padding in pixels (optional, default 0)"}},required:["south","west","north","east"]}},{name:"panBy",description:"Pans the map by the given distance in pixels (x, y). x increases east, y increases south. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{x:{type:"NUMBER",description:"Pixels to move in x direction (positive is east)"},y:{type:"NUMBER",description:"Pixels to move in y direction (positive is south)"}},required:["x","y"]}},{name:"setHeading",description:"Sets the compass heading for the map in degrees from cardinal North. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{heading:{type:"NUMBER",description:"The heading in degrees (0-360)"}},required:["heading"]}},{name:"setTilt",description:"Sets the angle of incidence of the map (tilt). This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{tilt:{type:"NUMBER",description:"The angle of tilt in degrees."}},required:["tilt"]}},{name:"setMapTypeId",description:"Sets the type of map to display. Allowed values: 'roadmap', 'satellite', 'hybrid', 'terrain'. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{mapTypeId:{type:"STRING",description:"The type of map. One of: 'roadmap', 'satellite', 'hybrid', 'terrain'."}},required:["mapTypeId"]}},{name:"showStreetView",description:"Shows the Street View panorama for the current map location. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{}}},{name:"hideStreetView",description:"Hides the Street View panorama and returns to the map view. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{}}},{name:"setStreetViewPov",description:"Rotates the camera to look in a specific direction or angle WITHOUT moving position. Use this for 'look up', 'turn right', 'look north'. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{heading:{type:"NUMBER",description:"The camera heading in degrees relative to true north (0-360)."},pitch:{type:"NUMBER",description:"The camera pitch in degrees (-90 to 90). 0 is level, 90 is straight up, -90 is straight down."}}}},{name:"navigateStreetView",description:"Moves the position of the Street View camera to the next panorama node in the specified direction. Use this for 'walk north', 'go forward', 'move northeast', 'step south'. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{direction:{type:"STRING",description:"The direction to move/walk: north, northeast, east, southeast, south, southwest, west, northwest."}},required:["direction"]}},{name:"lookAroundStreetView",description:"Simulates a mouse drag to pan/look around in Street View smoothly. Use this for 'pan left', 'look around to the right', 'drag view up'. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{direction:{type:"STRING",description:"The direction to look: left, right, up, down."}},required:["direction"]}},{name:"zoomInMap",description:"Zooms the map in (increases detail). Use this for 'Zoom in', 'Closer', 'Show me more detail'. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{level:{type:"NUMBER",description:"Optional specific zoom level (1-20). If omitted, zooms in by one step."}},required:[]}},{name:"zoomOutMap",description:"Zooms the map out (decreases detail/wider view). Use this for 'Zoom out', 'Further away', 'Show world view'. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{level:{type:"NUMBER",description:"Optional specific zoom level (1-20). If omitted, zooms out by one step."}},required:[]}},{name:"getMapZoom",description:"Returns the current zoom level of the map.",parameters:{type:"OBJECT",properties:{}}},{name:"showTraffic",description:"Shows real-time traffic information on the map by adding a traffic layer. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{}}},{name:"hideTraffic",description:"Hides real-time traffic information from the map. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{}}},{name:"showTransit",description:"Shows the public transit layer on the map. This layer highlights public transit network lines and stations. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{}}},{name:"hideTransit",description:"Hides the public transit layer from the map. This tool does NOT create markers or pins, it only changes the view.",parameters:{type:"OBJECT",properties:{}}}],lr=[{name:"searchPlaces",description:"Search for places using a free-form text query. Use this for specific names (e.g., 'Starbucks', 'Eiffel Tower'), subjective queries (e.g., 'best pizza', 'romantic dinner'), or vague requests that don't map to a specific place type. This is the default tool for most 'find' or 'search' requests.",parameters:{type:"OBJECT",properties:{query:{type:"STRING",description:"The text query for the search."},radius:{type:"NUMBER",description:"Search radius in meters (optional)."},biasTowardsMapCenter:{type:"BOOLEAN",description:"Whether to bias the search results towards the current map center (default: true)."},maxResults:{type:"NUMBER",description:"The maximum number of results to display."},minResults:{type:"NUMBER",description:"The minimum number of results to display."}},required:["query"]}},{name:"searchNearby",description:"Search for places near the map center using strict CATEGORIES (Place Types). Use this ONLY when the user asks for a specific category (e.g., 'gas stations', 'ATMs', 'parks') and you can map it to a valid Google Maps Place Type (e.g., 'gas_station', 'atm', 'park'). Do NOT use this for specific names or subjective queries.",parameters:{type:"OBJECT",properties:{radius:{type:"NUMBER",description:"Radius in meters for the search (required)."},includedTypes:{type:"ARRAY",items:{type:"STRING"},description:"List of place types to include (e.g., 'restaurant', 'gas_station'). See Google Maps Place Types."},excludedTypes:{type:"ARRAY",items:{type:"STRING"},description:"List of place types to exclude."},maxResultCount:{type:"NUMBER",description:"Maximum number of results to return (default 20)."},rankPreference:{type:"STRING",description:"Ranking preference: 'POPULARITY' or 'DISTANCE'.",enum:["POPULARITY","DISTANCE"]}},required:["radius","includedTypes"]}},{name:"getPlaceDetailsByPlaceId",description:"Get detailed information about a specific place using its Place ID.",parameters:{type:"OBJECT",properties:{placeId:{type:"STRING",description:"The Place ID of the location."},fields:{type:"ARRAY",items:{type:"STRING"},description:"List of fields to retrieve (e.g., 'name', 'formatted_address', 'rating', 'opening_hours')."}},required:["placeId"]}},{name:"getPlaceDetailsByLocation",description:"Get detailed information about a specific place by its name or address (e.g., 'White House', 'Eiffel Tower'). This tool will find the place, add a marker, and show its details in the side panel.",parameters:{type:"OBJECT",properties:{location:{type:"STRING",description:"The name or address of the place to find."}},required:["location"]}},{name:"getDirections",description:"Get directions between two locations.",parameters:{type:"OBJECT",properties:{origin:{type:"STRING",description:"Starting point (address, place name, or coordinates)."},destination:{type:"STRING",description:"Ending point (address, place name, or coordinates)."},travelMode:{type:"STRING",description:"Travel mode: 'DRIVING', 'WALKING', 'BICYCLING', 'TRANSIT'. Default is 'DRIVING'."}},required:["origin","destination"]}},{name:"getElevation",description:"Get elevation data for a specific location.",parameters:{type:"OBJECT",properties:{lat:{type:"NUMBER",description:"Latitude of the location."},lng:{type:"NUMBER",description:"Longitude of the location."}},required:["lat","lng"]}},{name:"clearMarkers",description:"Removes all search markers, pins, and info windows from the map. Use this when the user says 'clear the map', 'remove markers', 'hide pins', or 'start over'.",parameters:{type:"OBJECT",properties:{}}}],cr=[{name:"getCurrentConditions",description:"Get the current weather conditions for a specific location. You can provide a city name/address (e.g., 'Paris', 'Tokyo') OR latitude/longitude coordinates.",parameters:{type:"OBJECT",properties:{location:{type:"STRING",description:"City name, address, or landmark (e.g., 'Paris, France')."},lat:{type:"NUMBER",description:"Latitude of the location (optional if location name is provided)."},lng:{type:"NUMBER",description:"Longitude of the location (optional if location name is provided)."}}}},{name:"getDailyForecast",description:"Get the daily weather forecast (e.g. 10 days) for a specific location. You can provide a city name/address OR latitude/longitude coordinates.",parameters:{type:"OBJECT",properties:{location:{type:"STRING",description:"City name, address, or landmark (e.g., 'Paris, France')."},lat:{type:"NUMBER",description:"Latitude of the location (optional if location name is provided)."},lng:{type:"NUMBER",description:"Longitude of the location (optional if location name is provided)."}}}},{name:"closeWeatherInfo",description:"Closes the weather information panel.",parameters:{type:"OBJECT",properties:{}}}],ws="AIzaSyBEyMHI6C2bjOCRLnXexUgGs4e1U8bPY3I";let Ze;function ur(){return Ze=new ys(ws).getGenerativeModel({model:"gemini-2.0-flash-exp",tools:[{functionDeclarations:[...ar,...lr,...cr]}]}).startChat(),Ze}function xs(){return Ze||ur()}function vs(){const e=document.createElement("div");e.id="places-panel",e.innerHTML=`
    <div class="panel-header">
      <div style="display: flex; align-items: center;">
        <button id="back-to-list" style="display: none; margin-right: 8px; background: none; border: none; cursor: pointer; font-size: 18px; padding: 0;">
          <span class="material-symbols-outlined" style="font-size: 20px;">arrow_back</span>
        </button>
        <span id="panel-title">Places Found</span>
        <span id="places-count" style="margin-left: 8px; background-color: var(--primary-color); color: white; border-radius: 12px; padding: 2px 8px; font-size: 12px; font-weight: bold; display: none;"></span>
      </div>
      <button id="toggle-panel">▼</button>
    </div>
    <div id="places-list"></div>
    <div id="place-details" style="display: none;"></div>
  `,e.style.display="none";const t=e.querySelector("#toggle-panel"),n=e.querySelector("#places-list"),i=e.querySelector("#place-details"),r=e.querySelector("#back-to-list"),s=e.querySelector("#panel-title"),o=e.querySelector("#places-count");let a=n;return t.addEventListener("click",()=>{a.style.display==="none"?(a.style.display=a===n?"flex":"block",t.textContent="▼"):(a.style.display="none",t.textContent="▲")}),r.addEventListener("click",()=>{if(i.style.display="none",n.style.display="flex",r.style.display="none",s.textContent="Places Found",o.style.display="inline-block",t.textContent="▼",a=n,e.placesData&&e.placesData.length>0&&e.mapInstance){const l=new google.maps.LatLngBounds,c=e.mapInstance.getBounds();let u=!0;e.placesData.forEach(h=>{h.geometry&&h.geometry.location&&(l.extend(h.geometry.location),c&&!c.contains(h.geometry.location)&&(u=!1))}),(!u||!c)&&e.mapInstance.fitBounds(l,100)}}),e.setActiveView=l=>{l==="details"?a=i:a=n},e}function We(e){const t=document.getElementById("places-panel"),n=document.getElementById("places-list"),i=document.getElementById("place-details"),r=document.getElementById("back-to-list"),s=document.getElementById("panel-title"),o=document.getElementById("places-count");t&&(t.style.display="flex"),n&&(n.style.display="none"),i&&(i.style.display="block"),r&&(r.style.display="flex"),s&&(s.textContent=e.name),o&&(o.style.display="none"),t&&t.setActiveView&&t.setActiveView("details"),i&&(i.innerHTML=`
      <gmp-place-details>
        <gmp-place-details-place-request place="${e.place_id}"></gmp-place-details-place-request>
        <gmp-place-content-config>
          <gmp-place-address></gmp-place-address>
          <gmp-place-rating></gmp-place-rating>
          <gmp-place-type></gmp-place-type>
          <gmp-place-price></gmp-place-price>
          <gmp-place-accessible-entrance-icon></gmp-place-accessible-entrance-icon>
          <gmp-place-opening-hours></gmp-place-opening-hours>
          <gmp-place-website></gmp-place-website>
          <gmp-place-phone-number></gmp-place-phone-number>
          <gmp-place-summary></gmp-place-summary>
          <gmp-place-type-specific-highlights></gmp-place-type-specific-highlights>
          <gmp-place-reviews></gmp-place-reviews>
          <gmp-place-feature-list></gmp-place-feature-list>
          <gmp-place-media lightbox-preferred></gmp-place-media>
          <gmp-place-attribution light-scheme-color="gray" dark-scheme-color="white"></gmp-place-attribution>
        </gmp-place-content-config>
      </gmp-place-details>
    `)}function Ge(e,t,n={}){const i=document.getElementById("places-panel");i&&(i.placesData=e,i.mapInstance=t);const r=document.getElementById("places-list"),s=document.getElementById("place-details"),o=document.getElementById("back-to-list"),a=document.getElementById("panel-title"),l=document.getElementById("places-count"),c=document.getElementById("toggle-panel");!i||!r||(s.style.display="none",o.style.display="none",a.textContent="Places Found",i.setActiveView&&i.setActiveView("list"),e&&e.length>0?(i.style.display="flex",r.style.display="flex",c.textContent="▼",r.innerHTML="",l&&(l.textContent=e.length,l.style.display="inline-block"),e.forEach(u=>{const h=document.createElement("div");h.className="place-item",h.id=`place_card${u.place_id}`,h.innerHTML=`
        <gmp-place-details-compact orientation="horizontal" truncation-preferred slot="control-block-start-inline-center">
          <gmp-place-details-place-request place="${u.place_id}"></gmp-place-details-place-request>
          <gmp-place-content-config>
            <gmp-place-media lightbox-preferred></gmp-place-media>
            <gmp-place-rating></gmp-place-rating>
            <gmp-place-type></gmp-place-type>
            <gmp-place-price></gmp-place-price>
            <gmp-place-accessible-entrance-icon></gmp-place-accessible-entrance-icon>
            <gmp-place-open-now-status></gmp-place-open-now-status>
            <gmp-place-attribution light-scheme-color="gray" dark-scheme-color="white"></gmp-place-attribution>
          </gmp-place-content-config>
        </gmp-place-details-compact>
      `,n.onMouseEnter&&h.addEventListener("mouseenter",()=>{n.onMouseEnter(u.place_id)}),n.onMouseLeave&&h.addEventListener("mouseleave",()=>{n.onMouseLeave(u.place_id)}),h.addEventListener("click",()=>{if(t&&u.geometry&&u.geometry.location){const d=t.getBounds(),f=t.getZoom();d&&d.contains(u.geometry.location)&&f>=15||(t.setCenter(u.geometry.location),t.setZoom(15))}We(u)}),r.appendChild(h)})):(i.style.display="none",l&&(l.style.display="none")))}function Ue(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function ks(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function hr(e){let t,n,i;e.length!==2?(t=Ue,n=(a,l)=>Ue(e(a),l),i=(a,l)=>e(a)-l):(t=e===Ue||e===ks?e:bs,n=e,i=e);function r(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{const h=c+u>>>1;n(a[h],l)<0?c=h+1:u=h}while(c<u)}return c}function s(a,l,c=0,u=a.length){if(c<u){if(t(l,l)!==0)return u;do{const h=c+u>>>1;n(a[h],l)<=0?c=h+1:u=h}while(c<u)}return c}function o(a,l,c=0,u=a.length){const h=r(a,l,c,u-1);return h>c&&i(a[h-1],l)>-i(a[h],l)?h-1:h}return{left:r,center:o,right:s}}function bs(){return 0}function _s(e){return e===null?NaN:+e}const Es=hr(Ue),Ts=Es.right;hr(_s).center;const Ss=Math.sqrt(50),Cs=Math.sqrt(10),Rs=Math.sqrt(2);function Xe(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=Ss?10:s>=Cs?5:s>=Rs?2:1;let a,l,c;return r<0?(c=Math.pow(10,-r)/o,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,r)*o,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=n&&n<2?Xe(e,t,n*2):[a,l,c]}function Is(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,s,o]=i?Xe(t,e,n):Xe(e,t,n);if(!(s>=r))return[];const a=s-r+1,l=new Array(a);if(i)if(o<0)for(let c=0;c<a;++c)l[c]=(s-c)/-o;else for(let c=0;c<a;++c)l[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(r+c)/-o;else for(let c=0;c<a;++c)l[c]=(r+c)*o;return l}function kt(e,t,n){return t=+t,e=+e,n=+n,Xe(e,t,n)[2]}function As(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?kt(t,e,n):kt(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}var Ms={value:()=>{}};function dr(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new He(n)}function He(e){this._=e}function Ns(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}He.prototype=dr.prototype={constructor:He,on:function(e,t){var n=this._,i=Ns(e+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(e=i[s]).type)&&(r=$s(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(r=(e=i[s]).type)n[r]=En(n[r],e.name,t);else if(t==null)for(r in n)n[r]=En(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new He(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function $s(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function En(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=Ms,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var bt="http://www.w3.org/1999/xhtml";const Tn={svg:"http://www.w3.org/2000/svg",xhtml:bt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function ct(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),Tn.hasOwnProperty(t)?{space:Tn[t],local:e}:e}function Os(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===bt&&t.documentElement.namespaceURI===bt?t.createElement(e):t.createElementNS(n,e)}}function Ls(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function fr(e){var t=ct(e);return(t.local?Ls:Os)(t)}function Bs(){}function qt(e){return e==null?Bs:function(){return this.querySelector(e)}}function Ps(e){typeof e!="function"&&(e=qt(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=new Array(o),l,c,u=0;u<o;++u)(l=s[u])&&(c=e.call(l,l.__data__,u,s))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new C(i,this._parents)}function Ds(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function zs(){return[]}function pr(e){return e==null?zs:function(){return this.querySelectorAll(e)}}function qs(e){return function(){return Ds(e.apply(this,arguments))}}function Gs(e){typeof e=="function"?e=qs(e):e=pr(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var o=t[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(i.push(e.call(l,l.__data__,c,o)),r.push(l));return new C(i,r)}function gr(e){return function(){return this.matches(e)}}function mr(e){return function(t){return t.matches(e)}}var Us=Array.prototype.find;function Hs(e){return function(){return Us.call(this.children,e)}}function Fs(){return this.firstElementChild}function Vs(e){return this.select(e==null?Fs:Hs(typeof e=="function"?e:mr(e)))}var Ys=Array.prototype.filter;function Ks(){return Array.from(this.children)}function Js(e){return function(){return Ys.call(this.children,e)}}function Zs(e){return this.selectAll(e==null?Ks:Js(typeof e=="function"?e:mr(e)))}function Ws(e){typeof e!="function"&&(e=gr(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,c=0;c<o;++c)(l=s[c])&&e.call(l,l.__data__,c,s)&&a.push(l);return new C(i,this._parents)}function yr(e){return new Array(e.length)}function Xs(){return new C(this._enter||this._groups.map(yr),this._parents)}function je(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}je.prototype={constructor:je,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function js(e){return function(){return e}}function Qs(e,t,n,i,r,s){for(var o=0,a,l=t.length,c=s.length;o<c;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new je(e,s[o]);for(;o<l;++o)(a=t[o])&&(r[o]=a)}function eo(e,t,n,i,r,s,o){var a,l,c=new Map,u=t.length,h=s.length,d=new Array(u),f;for(a=0;a<u;++a)(l=t[a])&&(d[a]=f=o.call(l,l.__data__,a,t)+"",c.has(f)?r[a]=l:c.set(f,l));for(a=0;a<h;++a)f=o.call(e,s[a],a,s)+"",(l=c.get(f))?(i[a]=l,l.__data__=s[a],c.delete(f)):n[a]=new je(e,s[a]);for(a=0;a<u;++a)(l=t[a])&&c.get(d[a])===l&&(r[a]=l)}function to(e){return e.__data__}function no(e,t){if(!arguments.length)return Array.from(this,to);var n=t?eo:Qs,i=this._parents,r=this._groups;typeof e!="function"&&(e=js(e));for(var s=r.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=i[c],h=r[c],d=h.length,f=ro(e.call(u,u&&u.__data__,c,i)),p=f.length,g=a[c]=new Array(p),m=o[c]=new Array(p),S=l[c]=new Array(d);n(u,h,g,m,S,f,t);for(var b=0,E=0,B,v;b<p;++b)if(B=g[b]){for(b>=E&&(E=b+1);!(v=m[E])&&++E<p;);B._next=v||null}}return o=new C(o,i),o._enter=a,o._exit=l,o}function ro(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function io(){return new C(this._exit||this._groups.map(yr),this._parents)}function so(e,t,n){var i=this.enter(),r=this,s=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function oo(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),l=0;l<o;++l)for(var c=n[l],u=i[l],h=c.length,d=a[l]=new Array(h),f,p=0;p<h;++p)(f=c[p]||u[p])&&(d[p]=f);for(;l<r;++l)a[l]=n[l];return new C(a,this._parents)}function ao(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function lo(e){e||(e=co);function t(h,d){return h&&d?e(h.__data__,d.__data__):!h-!d}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,l=r[s]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(t)}return new C(r,this._parents).order()}function co(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function uo(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function ho(){return Array.from(this)}function fo(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function po(){let e=0;for(const t of this)++e;return e}function go(){return!this.node()}function mo(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&e.call(a,a.__data__,s,r);return this}function yo(e){return function(){this.removeAttribute(e)}}function wo(e){return function(){this.removeAttributeNS(e.space,e.local)}}function xo(e,t){return function(){this.setAttribute(e,t)}}function vo(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function ko(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function bo(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function _o(e,t){var n=ct(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?wo:yo:typeof t=="function"?n.local?bo:ko:n.local?vo:xo)(n,t))}function wr(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Eo(e){return function(){this.style.removeProperty(e)}}function To(e,t,n){return function(){this.style.setProperty(e,t,n)}}function So(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function Co(e,t,n){return arguments.length>1?this.each((t==null?Eo:typeof t=="function"?So:To)(e,t,n??"")):ae(this.node(),e)}function ae(e,t){return e.style.getPropertyValue(t)||wr(e).getComputedStyle(e,null).getPropertyValue(t)}function Ro(e){return function(){delete this[e]}}function Io(e,t){return function(){this[e]=t}}function Ao(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function Mo(e,t){return arguments.length>1?this.each((t==null?Ro:typeof t=="function"?Ao:Io)(e,t)):this.node()[e]}function xr(e){return e.trim().split(/^|\s+/)}function Gt(e){return e.classList||new vr(e)}function vr(e){this._node=e,this._names=xr(e.getAttribute("class")||"")}vr.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function kr(e,t){for(var n=Gt(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function br(e,t){for(var n=Gt(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function No(e){return function(){kr(this,e)}}function $o(e){return function(){br(this,e)}}function Oo(e,t){return function(){(t.apply(this,arguments)?kr:br)(this,e)}}function Lo(e,t){var n=xr(e+"");if(arguments.length<2){for(var i=Gt(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?Oo:t?No:$o)(n,t))}function Bo(){this.textContent=""}function Po(e){return function(){this.textContent=e}}function Do(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function zo(e){return arguments.length?this.each(e==null?Bo:(typeof e=="function"?Do:Po)(e)):this.node().textContent}function qo(){this.innerHTML=""}function Go(e){return function(){this.innerHTML=e}}function Uo(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Ho(e){return arguments.length?this.each(e==null?qo:(typeof e=="function"?Uo:Go)(e)):this.node().innerHTML}function Fo(){this.nextSibling&&this.parentNode.appendChild(this)}function Vo(){return this.each(Fo)}function Yo(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ko(){return this.each(Yo)}function Jo(e){var t=typeof e=="function"?e:fr(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Zo(){return null}function Wo(e,t){var n=typeof e=="function"?e:fr(e),i=t==null?Zo:typeof t=="function"?t:qt(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function Xo(){var e=this.parentNode;e&&e.removeChild(this)}function jo(){return this.each(Xo)}function Qo(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ea(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ta(e){return this.select(e?ea:Qo)}function na(e){return arguments.length?this.property("__data__",e):this.node().__data__}function ra(e){return function(t){e.call(this,t,this.__data__)}}function ia(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function sa(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,s;n<r;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function oa(e,t,n){return function(){var i=this.__on,r,s=ra(t);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=t;return}}this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function aa(e,t,n){var i=ia(e+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(r=0,u=a[l];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(a=t?oa:sa,r=0;r<s;++r)this.each(a(i[r],t,n));return this}function _r(e,t,n){var i=wr(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function la(e,t){return function(){return _r(this,e,t)}}function ca(e,t){return function(){return _r(this,e,t.apply(this,arguments))}}function ua(e,t){return this.each((typeof t=="function"?ca:la)(e,t))}function*ha(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var Er=[null];function C(e,t){this._groups=e,this._parents=t}function Ie(){return new C([[document.documentElement]],Er)}function da(){return this}C.prototype=Ie.prototype={constructor:C,select:Ps,selectAll:Gs,selectChild:Vs,selectChildren:Zs,filter:Ws,data:no,enter:Xs,exit:io,join:so,merge:oo,selection:da,order:ao,sort:lo,call:uo,nodes:ho,node:fo,size:po,empty:go,each:mo,attr:_o,style:Co,property:Mo,classed:Lo,text:zo,html:Ho,raise:Vo,lower:Ko,append:Jo,insert:Wo,remove:jo,clone:ta,datum:na,on:aa,dispatch:ua,[Symbol.iterator]:ha};function fa(e){return typeof e=="string"?new C([[document.querySelector(e)]],[document.documentElement]):new C([[e]],Er)}function Ut(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Tr(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Ae(){}var Ee=.7,Qe=1/Ee,oe="\\s*([+-]?\\d+)\\s*",Te="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",O="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",pa=/^#([0-9a-f]{3,8})$/,ga=new RegExp(`^rgb\\(${oe},${oe},${oe}\\)$`),ma=new RegExp(`^rgb\\(${O},${O},${O}\\)$`),ya=new RegExp(`^rgba\\(${oe},${oe},${oe},${Te}\\)$`),wa=new RegExp(`^rgba\\(${O},${O},${O},${Te}\\)$`),xa=new RegExp(`^hsl\\(${Te},${O},${O}\\)$`),va=new RegExp(`^hsla\\(${Te},${O},${O},${Te}\\)$`),Sn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ut(Ae,Q,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Cn,formatHex:Cn,formatHex8:ka,formatHsl:ba,formatRgb:Rn,toString:Rn});function Cn(){return this.rgb().formatHex()}function ka(){return this.rgb().formatHex8()}function ba(){return Sr(this).formatHsl()}function Rn(){return this.rgb().formatRgb()}function Q(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=pa.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?In(t):n===3?new T(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?Le(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?Le(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=ga.exec(e))?new T(t[1],t[2],t[3],1):(t=ma.exec(e))?new T(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=ya.exec(e))?Le(t[1],t[2],t[3],t[4]):(t=wa.exec(e))?Le(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=xa.exec(e))?Nn(t[1],t[2]/100,t[3]/100,1):(t=va.exec(e))?Nn(t[1],t[2]/100,t[3]/100,t[4]):Sn.hasOwnProperty(e)?In(Sn[e]):e==="transparent"?new T(NaN,NaN,NaN,0):null}function In(e){return new T(e>>16&255,e>>8&255,e&255,1)}function Le(e,t,n,i){return i<=0&&(e=t=n=NaN),new T(e,t,n,i)}function _a(e){return e instanceof Ae||(e=Q(e)),e?(e=e.rgb(),new T(e.r,e.g,e.b,e.opacity)):new T}function _t(e,t,n,i){return arguments.length===1?_a(e):new T(e,t,n,i??1)}function T(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}Ut(T,_t,Tr(Ae,{brighter(e){return e=e==null?Qe:Math.pow(Qe,e),new T(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ee:Math.pow(Ee,e),new T(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new T(W(this.r),W(this.g),W(this.b),et(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:An,formatHex:An,formatHex8:Ea,formatRgb:Mn,toString:Mn}));function An(){return`#${Z(this.r)}${Z(this.g)}${Z(this.b)}`}function Ea(){return`#${Z(this.r)}${Z(this.g)}${Z(this.b)}${Z((isNaN(this.opacity)?1:this.opacity)*255)}`}function Mn(){const e=et(this.opacity);return`${e===1?"rgb(":"rgba("}${W(this.r)}, ${W(this.g)}, ${W(this.b)}${e===1?")":`, ${e})`}`}function et(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function W(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Z(e){return e=W(e),(e<16?"0":"")+e.toString(16)}function Nn(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new N(e,t,n,i)}function Sr(e){if(e instanceof N)return new N(e.h,e.s,e.l,e.opacity);if(e instanceof Ae||(e=Q(e)),!e)return new N;if(e instanceof N)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,l=(s+r)/2;return a?(t===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-t)/a+2:o=(t-n)/a+4,a/=l<.5?s+r:2-s-r,o*=60):a=l>0&&l<1?0:o,new N(o,a,l,e.opacity)}function Ta(e,t,n,i){return arguments.length===1?Sr(e):new N(e,t,n,i??1)}function N(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}Ut(N,Ta,Tr(Ae,{brighter(e){return e=e==null?Qe:Math.pow(Qe,e),new N(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ee:Math.pow(Ee,e),new N(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new T(dt(e>=240?e-240:e+120,r,i),dt(e,r,i),dt(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new N($n(this.h),Be(this.s),Be(this.l),et(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=et(this.opacity);return`${e===1?"hsl(":"hsla("}${$n(this.h)}, ${Be(this.s)*100}%, ${Be(this.l)*100}%${e===1?")":`, ${e})`}`}}));function $n(e){return e=(e||0)%360,e<0?e+360:e}function Be(e){return Math.max(0,Math.min(1,e||0))}function dt(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Ht=e=>()=>e;function Sa(e,t){return function(n){return e+n*t}}function Ca(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function Ra(e){return(e=+e)==1?Cr:function(t,n){return n-t?Ca(t,n,e):Ht(isNaN(t)?n:t)}}function Cr(e,t){var n=t-e;return n?Sa(e,n):Ht(isNaN(e)?t:e)}const tt=(function e(t){var n=Ra(t);function i(r,s){var o=n((r=_t(r)).r,(s=_t(s)).r),a=n(r.g,s.g),l=n(r.b,s.b),c=Cr(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=a(u),r.b=l(u),r.opacity=c(u),r+""}}return i.gamma=e,i})(1);function Ia(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=e[r]*(1-s)+t[r]*s;return i}}function Aa(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Ma(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=Ft(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<i;++o)s[o]=r[o](a);return s}}function Na(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function M(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function $a(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=Ft(e[r],t[r]):i[r]=t[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var Et=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ft=new RegExp(Et.source,"g");function Oa(e){return function(){return e}}function La(e){return function(t){return e(t)+""}}function Rr(e,t){var n=Et.lastIndex=ft.lastIndex=0,i,r,s,o=-1,a=[],l=[];for(e=e+"",t=t+"";(i=Et.exec(e))&&(r=ft.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,l.push({i:o,x:M(i,r)})),n=ft.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?La(l[0].x):Oa(t):(t=l.length,function(c){for(var u=0,h;u<t;++u)a[(h=l[u]).i]=h.x(c);return a.join("")})}function Ft(e,t){var n=typeof t,i;return t==null||n==="boolean"?Ht(t):(n==="number"?M:n==="string"?(i=Q(t))?(t=i,tt):Rr:t instanceof Q?tt:t instanceof Date?Na:Aa(t)?Ia:Array.isArray(t)?Ma:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?$a:M)(e,t)}function Ba(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var On=180/Math.PI,Tt={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ir(e,t,n,i,r,s){var o,a,l;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(l=e*n+t*i)&&(n-=e*l,i-=t*l),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,l/=a),e*i<t*n&&(e=-e,t=-t,l=-l,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*On,skewX:Math.atan(l)*On,scaleX:o,scaleY:a}}var Pe;function Pa(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Tt:Ir(t.a,t.b,t.c,t.d,t.e,t.f)}function Da(e){return e==null||(Pe||(Pe=document.createElementNS("http://www.w3.org/2000/svg","g")),Pe.setAttribute("transform",e),!(e=Pe.transform.baseVal.consolidate()))?Tt:(e=e.matrix,Ir(e.a,e.b,e.c,e.d,e.e,e.f))}function Ar(e,t,n,i){function r(c){return c.length?c.pop()+" ":""}function s(c,u,h,d,f,p){if(c!==h||u!==d){var g=f.push("translate(",null,t,null,n);p.push({i:g-4,x:M(c,h)},{i:g-2,x:M(u,d)})}else(h||d)&&f.push("translate("+h+t+d+n)}function o(c,u,h,d){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),d.push({i:h.push(r(h)+"rotate(",null,i)-2,x:M(c,u)})):u&&h.push(r(h)+"rotate("+u+i)}function a(c,u,h,d){c!==u?d.push({i:h.push(r(h)+"skewX(",null,i)-2,x:M(c,u)}):u&&h.push(r(h)+"skewX("+u+i)}function l(c,u,h,d,f,p){if(c!==h||u!==d){var g=f.push(r(f)+"scale(",null,",",null,")");p.push({i:g-4,x:M(c,h)},{i:g-2,x:M(u,d)})}else(h!==1||d!==1)&&f.push(r(f)+"scale("+h+","+d+")")}return function(c,u){var h=[],d=[];return c=e(c),u=e(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,d),o(c.rotate,u.rotate,h,d),a(c.skewX,u.skewX,h,d),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,d),c=u=null,function(f){for(var p=-1,g=d.length,m;++p<g;)h[(m=d[p]).i]=m.x(f);return h.join("")}}}var za=Ar(Pa,"px, ","px)","deg)"),qa=Ar(Da,", ",")",")"),le=0,ye=0,pe=0,Mr=1e3,nt,we,rt=0,ee=0,ut=0,Se=typeof performance=="object"&&performance.now?performance:Date,Nr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Vt(){return ee||(Nr(Ga),ee=Se.now()+ut)}function Ga(){ee=0}function it(){this._call=this._time=this._next=null}it.prototype=$r.prototype={constructor:it,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Vt():+n)+(t==null?0:+t),!this._next&&we!==this&&(we?we._next=this:nt=this,we=this),this._call=e,this._time=n,St()},stop:function(){this._call&&(this._call=null,this._time=1/0,St())}};function $r(e,t,n){var i=new it;return i.restart(e,t,n),i}function Ua(){Vt(),++le;for(var e=nt,t;e;)(t=ee-e._time)>=0&&e._call.call(void 0,t),e=e._next;--le}function Ln(){ee=(rt=Se.now())+ut,le=ye=0;try{Ua()}finally{le=0,Fa(),ee=0}}function Ha(){var e=Se.now(),t=e-rt;t>Mr&&(ut-=t,rt=e)}function Fa(){for(var e,t=nt,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:nt=n);we=e,St(i)}function St(e){if(!le){ye&&(ye=clearTimeout(ye));var t=e-ee;t>24?(e<1/0&&(ye=setTimeout(Ln,e-Se.now()-ut)),pe&&(pe=clearInterval(pe))):(pe||(rt=Se.now(),pe=setInterval(Ha,Mr)),le=1,Nr(Ln))}}function Bn(e,t,n){var i=new it;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var Va=dr("start","end","cancel","interrupt"),Ya=[],Or=0,Pn=1,Ct=2,Fe=3,Dn=4,Rt=5,Ve=6;function ht(e,t,n,i,r,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;Ka(e,n,{name:t,index:i,group:r,on:Va,tween:Ya,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Or})}function Yt(e,t){var n=$(e,t);if(n.state>Or)throw new Error("too late; already scheduled");return n}function L(e,t){var n=$(e,t);if(n.state>Fe)throw new Error("too late; already running");return n}function $(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function Ka(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=$r(s,0,n.time);function s(c){n.state=Pn,n.timer.restart(o,n.delay,n.time),n.delay<=c&&o(c-n.delay)}function o(c){var u,h,d,f;if(n.state!==Pn)return l();for(u in i)if(f=i[u],f.name===n.name){if(f.state===Fe)return Bn(o);f.state===Dn?(f.state=Ve,f.timer.stop(),f.on.call("interrupt",e,e.__data__,f.index,f.group),delete i[u]):+u<t&&(f.state=Ve,f.timer.stop(),f.on.call("cancel",e,e.__data__,f.index,f.group),delete i[u])}if(Bn(function(){n.state===Fe&&(n.state=Dn,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=Ct,n.on.call("start",e,e.__data__,n.index,n.group),n.state===Ct){for(n.state=Fe,r=new Array(d=n.tween.length),u=0,h=-1;u<d;++u)(f=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(r[++h]=f);r.length=h+1}}function a(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=Rt,1),h=-1,d=r.length;++h<d;)r[h].call(e,u);n.state===Rt&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){n.state=Ve,n.timer.stop(),delete i[t];for(var c in i)return;delete e.__transition}}function Ja(e,t){var n=e.__transition,i,r,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((i=n[o]).name!==t){s=!1;continue}r=i.state>Ct&&i.state<Rt,i.state=Ve,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[o]}s&&delete e.__transition}}function Za(e){return this.each(function(){Ja(this,e)})}function Wa(e,t){var n,i;return function(){var r=L(this,e),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function Xa(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=L(this,e),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:t,value:n},l=0,c=r.length;l<c;++l)if(r[l].name===t){r[l]=a;break}l===c&&r.push(a)}s.tween=r}}function ja(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=$(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((t==null?Wa:Xa)(n,e,t))}function Kt(e,t,n){var i=e._id;return e.each(function(){var r=L(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return $(r,i).value[t]}}function Lr(e,t){var n;return(typeof t=="number"?M:t instanceof Q?tt:(n=Q(t))?(t=n,tt):Rr)(e,t)}function Qa(e){return function(){this.removeAttribute(e)}}function el(e){return function(){this.removeAttributeNS(e.space,e.local)}}function tl(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttribute(e);return o===r?null:o===i?s:s=t(i=o,n)}}function nl(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===i?s:s=t(i=o,n)}}function rl(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function il(e,t,n){var i,r,s;return function(){var o,a=n(this),l;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),l=a+"",o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a)))}}function sl(e,t){var n=ct(e),i=n==="transform"?qa:Lr;return this.attrTween(e,typeof t=="function"?(n.local?il:rl)(n,i,Kt(this,"attr."+e,t)):t==null?(n.local?el:Qa)(n):(n.local?nl:tl)(n,i,t))}function ol(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function al(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function ll(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&al(e,s)),n}return r._value=t,r}function cl(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&ol(e,s)),n}return r._value=t,r}function ul(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=ct(e);return this.tween(n,(i.local?ll:cl)(i,t))}function hl(e,t){return function(){Yt(this,e).delay=+t.apply(this,arguments)}}function dl(e,t){return t=+t,function(){Yt(this,e).delay=t}}function fl(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?hl:dl)(t,e)):$(this.node(),t).delay}function pl(e,t){return function(){L(this,e).duration=+t.apply(this,arguments)}}function gl(e,t){return t=+t,function(){L(this,e).duration=t}}function ml(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?pl:gl)(t,e)):$(this.node(),t).duration}function yl(e,t){if(typeof t!="function")throw new Error;return function(){L(this,e).ease=t}}function wl(e){var t=this._id;return arguments.length?this.each(yl(t,e)):$(this.node(),t).ease}function xl(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;L(this,e).ease=n}}function vl(e){if(typeof e!="function")throw new Error;return this.each(xl(this._id,e))}function kl(e){typeof e!="function"&&(e=gr(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],l,c=0;c<o;++c)(l=s[c])&&e.call(l,l.__data__,c,s)&&a.push(l);return new U(i,this._parents,this._name,this._id)}function bl(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var l=t[a],c=n[a],u=l.length,h=o[a]=new Array(u),d,f=0;f<u;++f)(d=l[f]||c[f])&&(h[f]=d);for(;a<i;++a)o[a]=t[a];return new U(o,this._parents,this._name,this._id)}function _l(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function El(e,t,n){var i,r,s=_l(t)?Yt:L;return function(){var o=s(this,e),a=o.on;a!==i&&(r=(i=a).copy()).on(t,n),o.on=r}}function Tl(e,t){var n=this._id;return arguments.length<2?$(this.node(),n).on.on(e):this.each(El(n,e,t))}function Sl(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function Cl(){return this.on("end.remove",Sl(this._id))}function Rl(e){var t=this._name,n=this._id;typeof e!="function"&&(e=qt(e));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],l=a.length,c=s[o]=new Array(l),u,h,d=0;d<l;++d)(u=a[d])&&(h=e.call(u,u.__data__,d,a))&&("__data__"in u&&(h.__data__=u.__data__),c[d]=h,ht(c[d],t,n,d,c,$(u,n)));return new U(s,this._parents,t,n)}function Il(e){var t=this._name,n=this._id;typeof e!="function"&&(e=pr(e));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var l=i[a],c=l.length,u,h=0;h<c;++h)if(u=l[h]){for(var d=e.call(u,u.__data__,h,l),f,p=$(u,n),g=0,m=d.length;g<m;++g)(f=d[g])&&ht(f,t,n,g,d,p);s.push(d),o.push(u)}return new U(s,o,t,n)}var Al=Ie.prototype.constructor;function Ml(){return new Al(this._groups,this._parents)}function Nl(e,t){var n,i,r;return function(){var s=ae(this,e),o=(this.style.removeProperty(e),ae(this,e));return s===o?null:s===n&&o===i?r:r=t(n=s,i=o)}}function Br(e){return function(){this.style.removeProperty(e)}}function $l(e,t,n){var i,r=n+"",s;return function(){var o=ae(this,e);return o===r?null:o===i?s:s=t(i=o,n)}}function Ol(e,t,n){var i,r,s;return function(){var o=ae(this,e),a=n(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(e),ae(this,e))),o===l?null:o===i&&l===r?s:(r=l,s=t(i=o,a))}}function Ll(e,t){var n,i,r,s="style."+t,o="end."+s,a;return function(){var l=L(this,e),c=l.on,u=l.value[s]==null?a||(a=Br(t)):void 0;(c!==n||r!==u)&&(i=(n=c).copy()).on(o,r=u),l.on=i}}function Bl(e,t,n){var i=(e+="")=="transform"?za:Lr;return t==null?this.styleTween(e,Nl(e,i)).on("end.style."+e,Br(e)):typeof t=="function"?this.styleTween(e,Ol(e,i,Kt(this,"style."+e,t))).each(Ll(this._id,e)):this.styleTween(e,$l(e,i,t),n).on("end.style."+e,null)}function Pl(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function Dl(e,t,n){var i,r;function s(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&Pl(e,o,n)),i}return s._value=t,s}function zl(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,Dl(e,t,n??""))}function ql(e){return function(){this.textContent=e}}function Gl(e){return function(){var t=e(this);this.textContent=t??""}}function Ul(e){return this.tween("text",typeof e=="function"?Gl(Kt(this,"text",e)):ql(e==null?"":e+""))}function Hl(e){return function(t){this.textContent=e.call(this,t)}}function Fl(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&Hl(r)),t}return i._value=e,i}function Vl(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,Fl(e))}function Yl(){for(var e=this._name,t=this._id,n=Pr(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var u=$(l,t);ht(l,e,n,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new U(i,this._parents,e,n)}function Kl(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--r===0&&s()}};n.each(function(){var c=L(this,i),u=c.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),r===0&&s()})}var Jl=0;function U(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Pr(){return++Jl}var D=Ie.prototype;U.prototype={constructor:U,select:Rl,selectAll:Il,selectChild:D.selectChild,selectChildren:D.selectChildren,filter:kl,merge:bl,selection:Ml,transition:Yl,call:D.call,nodes:D.nodes,node:D.node,size:D.size,empty:D.empty,each:D.each,on:Tl,attr:sl,attrTween:ul,style:Bl,styleTween:zl,text:Ul,textTween:Vl,remove:Cl,tween:ja,delay:fl,duration:ml,ease:wl,easeVarying:vl,end:Kl,[Symbol.iterator]:D[Symbol.iterator]};function Zl(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Wl={time:null,delay:0,duration:250,ease:Zl};function Xl(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function jl(e){var t,n;e instanceof U?(t=e._id,e=e._name):(t=Pr(),(n=Wl).time=Vt(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&ht(l,e,t,c,o,n||Xl(l,t));return new U(i,this._parents,e,t)}Ie.prototype.interrupt=Za;Ie.prototype.transition=jl;function Ql(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function st(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function ce(e){return e=st(Math.abs(e)),e?e[1]:NaN}function ec(e,t){return function(n,i){for(var r=n.length,s=[],o=0,a=e[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function tc(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var nc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ot(e){if(!(t=nc.exec(e)))throw new Error("invalid format: "+e);var t;return new Jt({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ot.prototype=Jt.prototype;function Jt(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Jt.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function rc(e){e:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Dr;function ic(e,t){var n=st(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(Dr=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+st(e,Math.max(0,t+s-1))[0]}function zn(e,t){var n=st(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const qn={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Ql,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>zn(e*100,t),r:zn,s:ic,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Gn(e){return e}var Un=Array.prototype.map,Hn=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function sc(e){var t=e.grouping===void 0||e.thousands===void 0?Gn:ec(Un.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Gn:tc(Un.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function c(h){h=ot(h);var d=h.fill,f=h.align,p=h.sign,g=h.symbol,m=h.zero,S=h.width,b=h.comma,E=h.precision,B=h.trim,v=h.type;v==="n"?(b=!0,v="g"):qn[v]||(E===void 0&&(E=12),B=!0,v="g"),(m||d==="0"&&f==="=")&&(m=!0,d="0",f="=");var Hr=g==="$"?n:g==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",Fr=g==="$"?i:/[%p]/.test(v)?o:"",Zt=qn[v],Vr=/[defgprs%]/.test(v);E=E===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,E)):Math.max(0,Math.min(20,E));function Wt(y){var V=Hr,R=Fr,ne,Xt,Me;if(v==="c")R=Zt(y)+R,y="";else{y=+y;var Ne=y<0||1/y<0;if(y=isNaN(y)?l:Zt(Math.abs(y),E),B&&(y=rc(y)),Ne&&+y==0&&p!=="+"&&(Ne=!1),V=(Ne?p==="("?p:a:p==="-"||p==="("?"":p)+V,R=(v==="s"?Hn[8+Dr/3]:"")+R+(Ne&&p==="("?")":""),Vr){for(ne=-1,Xt=y.length;++ne<Xt;)if(Me=y.charCodeAt(ne),48>Me||Me>57){R=(Me===46?r+y.slice(ne+1):y.slice(ne))+R,y=y.slice(0,ne);break}}}b&&!m&&(y=t(y,1/0));var $e=V.length+y.length+R.length,P=$e<S?new Array(S-$e+1).join(d):"";switch(b&&m&&(y=t(P+y,P.length?S-R.length:1/0),P=""),f){case"<":y=V+y+R+P;break;case"=":y=V+P+y+R;break;case"^":y=P.slice(0,$e=P.length>>1)+V+y+R+P.slice($e);break;default:y=P+V+y+R;break}return s(y)}return Wt.toString=function(){return h+""},Wt}function u(h,d){var f=c((h=ot(h),h.type="f",h)),p=Math.max(-8,Math.min(8,Math.floor(ce(d)/3)))*3,g=Math.pow(10,-p),m=Hn[8+p/3];return function(S){return f(g*S)+m}}return{format:c,formatPrefix:u}}var De,zr,qr;oc({thousands:",",grouping:[3],currency:["$",""]});function oc(e){return De=sc(e),zr=De.format,qr=De.formatPrefix,De}function ac(e){return Math.max(0,-ce(Math.abs(e)))}function lc(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ce(t)/3)))*3-ce(Math.abs(e)))}function cc(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,ce(t)-ce(e))+1}function uc(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function hc(e){return function(){return e}}function dc(e){return+e}var Fn=[0,1];function se(e){return e}function It(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:hc(isNaN(t)?NaN:.5)}function fc(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function pc(e,t,n){var i=e[0],r=e[1],s=t[0],o=t[1];return r<i?(i=It(r,i),s=n(o,s)):(i=It(i,r),s=n(s,o)),function(a){return s(i(a))}}function gc(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=It(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var l=Ts(e,a,1,i)-1;return s[l](r[l](a))}}function mc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yc(){var e=Fn,t=Fn,n=Ft,i,r,s,o=se,a,l,c;function u(){var d=Math.min(e.length,t.length);return o!==se&&(o=fc(e[0],e[d-1])),a=d>2?gc:pc,l=c=null,h}function h(d){return d==null||isNaN(d=+d)?s:(l||(l=a(e.map(i),t,n)))(i(o(d)))}return h.invert=function(d){return o(r((c||(c=a(t,e.map(i),M)))(d)))},h.domain=function(d){return arguments.length?(e=Array.from(d,dc),u()):e.slice()},h.range=function(d){return arguments.length?(t=Array.from(d),u()):t.slice()},h.rangeRound=function(d){return t=Array.from(d),n=Ba,u()},h.clamp=function(d){return arguments.length?(o=d?!0:se,u()):o!==se},h.interpolate=function(d){return arguments.length?(n=d,u()):n},h.unknown=function(d){return arguments.length?(s=d,h):s},function(d,f){return i=d,r=f,u()}}function wc(){return yc()(se,se)}function xc(e,t,n,i){var r=As(e,t,n),s;switch(i=ot(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(s=lc(r,o))&&(i.precision=s),qr(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=cc(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=ac(r))&&(i.precision=s-(i.type==="%")*2);break}}return zr(i)}function vc(e){var t=e.domain;return e.ticks=function(n){var i=t();return Is(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return xc(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,s=i.length-1,o=i[r],a=i[s],l,c,u=10;for(a<o&&(c=o,o=a,a=c,c=r,r=s,s=c);u-- >0;){if(c=kt(o,a,n),c===l)return i[r]=o,i[s]=a,t(i);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return e},e}function Gr(){var e=wc();return e.copy=function(){return mc(e,Gr())},uc.apply(e,arguments),vc(e)}function xe(e,t,n){this.k=e,this.x=t,this.y=n}xe.prototype={constructor:xe,scale:function(e){return e===1?this:new xe(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new xe(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};xe.prototype;function kc(){const e=document.createElement("div");return e.id="weather-panel",e.style.display="none",e.innerHTML=`
    <div class="panel-header">
      <span id="weather-panel-title">Weather</span>
      <button id="close-weather-panel" style="background:none; border:none; cursor:pointer; font-size:18px;">×</button>
    </div>
    <div id="weather-content"></div>
    <div id="weather-chart" style="padding: 10px;"></div>
  `,e.querySelector("#close-weather-panel").addEventListener("click",()=>{e.style.display="none"}),e}function bc(e){const t=document.getElementById("weather-panel");if(!t)return;t.style.display="flex";const n=document.getElementById("weather-content"),i=document.getElementById("weather-chart");if(document.getElementById("weather-panel-title"),n.innerHTML="",i.innerHTML="",!e)return;const r=e.temperature.degrees,s=e.weatherCondition.description.text,o=e.weatherCondition.iconBaseUri+".png";if(n.innerHTML=`
    <div style="display: flex; align-items: center; justify-content: space-between; padding: 15px;">
      <div>
        <h2 style="margin: 0; font-size: 42px; font-weight: 300;">${r}°</h2>
        <p style="margin: 5px 0 0; font-size: 16px; color: var(--text-secondary);">${s}</p>
        <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">Feels like ${e.feelsLikeTemperature.degrees}°</p>
      </div>
      <img src="${o}" alt="${s}" style="width: 80px; height: 80px;" onerror="this.style.display='none'">
    </div>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 15px 15px; font-size: 13px; color: var(--text-secondary);">
      <div style="display: flex; flex-direction: column;">
        <span style="font-weight: 500; color: var(--text-primary);">Humidity</span>
        <span>${e.relativeHumidity}%</span>
      </div>
      <div style="display: flex; flex-direction: column;">
        <span style="font-weight: 500; color: var(--text-primary);">Wind</span>
        <span>${e.wind.speed.value} ${e.wind.speed.unit==="KILOMETERS_PER_HOUR"?"km/h":e.wind.speed.unit}</span>
      </div>
      <div style="display: flex; flex-direction: column;">
        <span style="font-weight: 500; color: var(--text-primary);">UV Index</span>
        <span>${e.uvIndex}</span>
      </div>
      <div style="display: flex; flex-direction: column;">
        <span style="font-weight: 500; color: var(--text-primary);">Visibility</span>
        <span>${e.visibility.distance} km</span>
      </div>
    </div>
  `,e.currentConditionsHistory){const a=e.currentConditionsHistory.minTemperature.degrees,l=e.currentConditionsHistory.maxTemperature.degrees,c=320,u=60,h={left:20,right:20},d=fa(i).append("svg").attr("width","100%").attr("height",u).attr("viewBox",`0 0 ${c} ${u}`),f=Math.min(a,r),p=Math.max(l,r),g=(p-f)*.1||2,m=Gr().domain([f-g,p+g]).range([h.left,c-h.right]);d.append("line").attr("x1",m(a)).attr("x2",m(l)).attr("y1",u/2).attr("y2",u/2).attr("stroke","#e0e0e0").attr("stroke-width",6).attr("stroke-linecap","round"),d.append("line").attr("x1",m(a)).attr("x2",m(l)).attr("y1",u/2).attr("y2",u/2).attr("stroke","url(#temp-gradient)").attr("stroke-width",6).attr("stroke-linecap","round");const b=d.append("defs").append("linearGradient").attr("id","temp-gradient");b.append("stop").attr("offset","0%").attr("stop-color","#4285F4"),b.append("stop").attr("offset","100%").attr("stop-color","#EA4335"),d.append("circle").attr("cx",m(r)).attr("cy",u/2).attr("r",8).attr("fill","#fff").attr("stroke","#333").attr("stroke-width",2),d.append("text").attr("x",m(a)).attr("y",u/2+20).attr("text-anchor","middle").text(`L:${a}°`).style("font-size","11px").style("fill","#666"),d.append("text").attr("x",m(l)).attr("y",u/2+20).attr("text-anchor","middle").text(`H:${l}°`).style("font-size","11px").style("fill","#666")}}function _c(e){const t=document.getElementById("weather-panel");if(!t)return;t.style.display="flex";const n=document.getElementById("weather-content"),i=document.getElementById("weather-chart"),r=document.getElementById("weather-panel-title");if(r.textContent="Daily Forecast",n.innerHTML="",i.innerHTML="",!e||!e.forecastDays)return;const s=document.createElement("div");s.style.padding="0 15px",e.forecastDays.forEach(o=>{const a=new Date(o.displayDate.year,o.displayDate.month-1,o.displayDate.day),l=a.toLocaleDateString("en-US",{weekday:"short"}),c=a.toLocaleDateString("en-US",{month:"numeric",day:"numeric"}),u=Math.round(o.minTemperature.degrees),h=Math.round(o.maxTemperature.degrees),d=o.daytimeForecast?.weatherCondition?.description?.text||"",f=o.daytimeForecast?.weatherCondition?.iconBaseUri?o.daytimeForecast.weatherCondition.iconBaseUri+".png":"",p=o.daytimeForecast?.precipitation?.probability?.percent||0,g=o.daytimeForecast?.relativeHumidity||0,m=document.createElement("div");m.style.cssText="display: grid; grid-template-columns: 50px 1fr 80px 60px; align-items: center; padding: 12px 0; border-bottom: 1px solid #f1f3f4; font-size: 13px;",m.innerHTML=`
        <div style="display:flex; flex-direction:column; line-height:1.2;">
            <span style="font-weight: 500;">${l}</span>
            <span style="color: var(--text-secondary); font-size: 11px;">${c}</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
           <img src="${f}" style="width: 28px; height: 28px;" onerror="this.style.display='none'">
           <div style="display:flex; flex-direction:column; line-height:1.2;">
               <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100px;">${d}</span>
           </div>
        </div>
        <div style="display:flex; flex-direction:column; color: var(--text-secondary); font-size: 11px; line-height:1.3;">
            <span>💧 ${p}%</span>
            <span>HUM: ${g}%</span>
        </div>
        <div style="text-align: right;">
           <span style="color: var(--text-secondary); margin-right: 4px;">${u}°</span>
           <span style="font-weight: 500;">${h}°</span>
        </div>
      `,s.appendChild(m)}),n.appendChild(s)}function ge(e,t){t&&t.getVisible()&&t.setPosition(e.getCenter())}function Ec(e,t,n,i,r,s=500){const a=s/20,l=new MouseEvent("mousedown",{clientX:t,clientY:n,bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(l);let c=0;const u=()=>{c++;const h=c/20,d=t+(i-t)*h,f=n+(r-n)*h,p=new MouseEvent("mousemove",{clientX:d,clientY:f,bubbles:!0,cancelable:!0,view:window});if(e.dispatchEvent(p),c<20)setTimeout(u,a);else{const g=new MouseEvent("mouseup",{clientX:i,clientY:r,bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(g)}};u()}let Y=null,K=null,J=null,ue=[];function pt(){ue.forEach(e=>e.setMap(null)),ue=[],Ge([])}const ie={onMouseEnter:e=>{const t=ue.find(n=>n.element.id===`place_marker${e}`);t&&t.content&&(t.content.background=null,t.content.borderColor=null,t.content.glyphColor="white")},onMouseLeave:e=>{const t=ue.find(n=>n.element.id===`place_marker${e}`);t&&t.content&&(t.content.background=t.originalColor,t.content.borderColor=t.originalColor,t.content.glyphColor=null)}};function gt(e){return{place_id:e.id,name:e.displayName,formatted_address:e.formattedAddress,geometry:{location:e.location},rating:e.rating,photos:e.photos,icon_mask_base_uri:e.svgIconMaskURI,icon_background_color:e.iconBackgroundColor}}function mt(e,t,n){if(!e.geometry||!e.geometry.location)return null;const i=new google.maps.marker.PinElement({background:e.icon_background_color||null,borderColor:e.icon_background_color||null,glyphSrc:e.icon_mask_base_uri?new URL(String(e.icon_mask_base_uri)):void 0}),r=new google.maps.marker.AdvancedMarkerElement({map:t,position:e.geometry.location,title:e.name,gmpClickable:!0});return r.element.id=`place_marker${e.place_id}`,r.originalColor=e.icon_background_color,r.append(i),r.addEventListener("gmp-click",()=>{if(t&&e.geometry&&e.geometry.location){const s=t.getBounds(),o=t.getZoom();s&&s.contains(e.geometry.location)&&o>=15||(t.setCenter(e.geometry.location),t.setZoom(15))}We(e)}),r.element.addEventListener("mouseenter",()=>{n.onMouseEnter(e.place_id)}),r.element.addEventListener("mouseleave",()=>{n.onMouseLeave(e.place_id)}),ue.push(r),r}async function Ur(e,t,n,i,r,s,o){if(console.log(`Executing tool: ${e}`,t),e==="panToLocation"){if(!i)return"Error: Geocoder not ready or initialized.";try{const{results:a}=await i.geocode({address:t.locationName});if(a&&a[0]){const l=a[0].geometry.location;return n.panTo(l),ge(n,r),`Successfully executed map.panTo() to move map to ${t.locationName}`}else return`Error: Could not find location '${t.locationName}'. Please check the spelling.`}catch(a){return console.error("Geocoding failed",a),`Error: Geocoding failed for '${t.locationName}'. Reason: ${a.message}`}}else if(e==="panToCoordinates"){if(!n)return"Error: Map not initialized.";const a={lat:t.lat,lng:t.lng};return n.panTo(a),ge(n,r),`Successfully executed map.panTo() to move map to coordinates: ${t.lat}, ${t.lng}`}else if(e==="setCenter"){if(!n)return"Error: Map not initialized.";const a={lat:t.lat,lng:t.lng};return n.setCenter(a),ge(n,r),`Successfully executed map.setCenter() with coordinates: ${t.lat}, ${t.lng}`}else if(e==="panToBounds"){if(!n)return"Error: Map not initialized.";const a={south:t.south,west:t.west,north:t.north,east:t.east},l=t.padding||0;return n.panToBounds(a,l),ge(n,r),`Successfully executed map.panToBounds() with bounds: [${a.south}, ${a.west}, ${a.north}, ${a.east}] and padding: ${l}`}else{if(e==="panBy")return n?(n.panBy(t.x,t.y),ge(n,r),`Successfully executed map.panBy(${t.x}, ${t.y})`):"Error: Map not initialized.";if(e==="setHeading")return n?(n.setHeading(t.heading),`Successfully executed map.setHeading(${t.heading})`):"Error: Map not initialized.";if(e==="setTilt")return n?(n.setTilt(t.tilt),`Successfully executed map.setTilt(${t.tilt})`):"Error: Map not initialized.";if(e==="setMapTypeId"){if(!n)return"Error: Map not initialized.";const a=["roadmap","satellite","hybrid","terrain"];return a.includes(t.mapTypeId)?(n.setMapTypeId(t.mapTypeId),`Successfully executed map.setMapTypeId('${t.mapTypeId}')`):`Error: Invalid map type '${t.mapTypeId}'. Valid types are: ${a.join(", ")}.`}else if(e==="zoomInMap"){if(!n)return"Error: Map not initialized.";const a=t||{},l=n.getZoom(),c=a.level!==void 0?a.level:l+1;return n.setZoom(c),`Successfully executed zoomInMap. New zoom level: ${c}`}else if(e==="zoomOutMap"){if(!n)return"Error: Map not initialized.";const a=t||{},l=n.getZoom(),c=a.level!==void 0?a.level:l-1;return n.setZoom(c),`Successfully executed zoomOutMap. New zoom level: ${c}`}else{if(e==="getMapZoom")return n?`Current map zoom level is ${n.getZoom()}.`:"Error: Map not initialized.";if(e==="showTraffic")return n?(K||(K=new google.maps.TrafficLayer),K.setMap(n),"Traffic layer displayed."):"Error: Map not initialized.";if(e==="hideTraffic")return n?(K&&K.setMap(null),"Traffic layer hidden."):"Error: Map not initialized.";if(e==="showTransit")return n?(J||(J=new google.maps.TransitLayer),J.setMap(n),"Transit layer displayed."):"Error: Map not initialized.";if(e==="hideTransit")return n?(J&&J.setMap(null),"Transit layer hidden."):"Error: Map not initialized.";if(e==="showStreetView")return r?(document.getElementById("map-container").classList.add("split-view"),r.setPosition(n.getCenter()),r.setPov({heading:n.getHeading()||0,pitch:0}),r.setVisible(!0),n.setStreetView(r),setTimeout(()=>{google.maps.event.trigger(n,"resize")},550),"Successfully showed Street View in split mode."):"Error: Street View not initialized.";if(e==="hideStreetView")return r?(document.getElementById("map-container").classList.remove("split-view"),r.setVisible(!1),setTimeout(()=>{google.maps.event.trigger(n,"resize")},550),"Successfully hidden Street View."):"Error: Street View not initialized.";if(e==="setStreetViewPov"){if(!r||!r.getVisible())return"Error: Street View is not currently visible. Show it first.";const a=r.getPov(),l={heading:t.heading!==void 0?t.heading:a.heading,pitch:t.pitch!==void 0?t.pitch:a.pitch};return r.setPov(l),`Successfully executed panorama.setPov() with heading: ${l.heading}, pitch: ${l.pitch}`}else if(e==="navigateStreetView"){if(!r||!r.getVisible())return"Error: Street View is not currently visible. Show it first.";const a=t.direction.toLowerCase(),l=document.getElementById("pano"),c=Array.from(l.querySelectorAll("div")).filter(f=>f.className.includes("sv-links-control"));if(c.length===0)return"Error: Could not find Street View navigation controls (sv-links-control).";const u=c[c.length-1],d=Array.from(u.querySelectorAll("path")).find(f=>{const p=f.getAttribute("aria-label");return p&&p.toLowerCase().includes(a)});if(d){const f=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});return d.dispatchEvent(f),`Successfully simulated click to move ${a}.`}else return`Error: Unable to move ${a}. The navigation arrow for '${a}' was not found in the current view. Please inform the user that they cannot move in that direction here.`}else if(e==="lookAroundStreetView"){if(!r||!r.getVisible())return"Error: Street View is not currently visible. Show it first.";const a=document.getElementById("pano"),l=a.getBoundingClientRect(),c=l.left+l.width/2,u=l.top+l.height/2;let h=c,d=u;const f=200,p=t.direction.toLowerCase();if(p==="left")h+=f;else if(p==="right")h-=f;else if(p==="up")d+=f;else if(p==="down")d-=f;else return"Error: Invalid direction. Use left, right, up, or down.";const g=a.querySelector("canvas")||a;return Ec(g,c,u,h,d),`Successfully simulated mouse drag to look ${p}.`}else if(e==="searchPlaces"){if(!google.maps.places)return"Error: Places library not loaded.";try{const a={textQuery:t.query,fields:["id","displayName","formattedAddress","location","rating","photos","svgIconMaskURI","iconBackgroundColor"]};t.biasTowardsMapCenter&&n&&(a.locationBias=n.getCenter());const{places:l}=await google.maps.places.Place.searchByText(a);if(l&&l.length>0){let c=l;t.maxResults!==void 0&&(c=c.slice(0,t.maxResults)),t.minResults!==void 0&&c.length<t.minResults&&console.warn(`Only found ${c.length} results, which is less than the requested minimum of ${t.minResults}.`);const u=c.map(gt);pt(),Ge(u,n,ie);const h=new google.maps.LatLngBounds;u.forEach(f=>{f.geometry&&f.geometry.location&&(mt(f,n,ie),h.extend(f.geometry.location))}),n&&!t.biasTowardsMapCenter&&n.fitBounds(h,100);const d=u.map(f=>`${f.name} (${f.rating}★) - ${f.formatted_address}`).join(`
`);return`Found ${u.length} places. Results:
${d}`}else return"No places found."}catch(a){return`Error searching for places: ${a.message}`}}else if(e==="searchNearby"){if(!google.maps.places)return"Error: Places library not loaded.";try{const a={fields:["id","displayName","formattedAddress","location","rating","photos","svgIconMaskURI","iconBackgroundColor"],locationRestriction:{center:n.getCenter(),radius:t.radius}};t.includedTypes&&(a.includedTypes=t.includedTypes),t.excludedTypes&&(a.excludedTypes=t.excludedTypes),t.maxResultCount&&(a.maxResultCount=t.maxResultCount),t.rankPreference&&(a.rankPreference=google.maps.places.SearchNearbyRankPreference[t.rankPreference]);const{places:l}=await google.maps.places.Place.searchNearby(a);if(l&&l.length>0){const c=l.map(gt);pt(),Ge(c,n,ie);const u=new google.maps.LatLngBounds;c.forEach(d=>{d.geometry&&d.geometry.location&&(mt(d,n,ie),u.extend(d.geometry.location))}),n&&n.fitBounds(u,100);const h=c.map(d=>`${d.name} (${d.rating}★) - ${d.formatted_address}`).join(`
`);return`Found ${c.length} places nearby. Results:
${h}`}else return"No places found nearby."}catch(a){return`Error searching nearby: ${a.message}`}}else if(e==="getPlaceDetailsByLocation"){if(!google.maps.places)return"Error: Places library not loaded.";try{const a={textQuery:t.location,fields:["id","displayName","formattedAddress","location","rating","photos","svgIconMaskURI","iconBackgroundColor"]};t.biasTowardsMapCenter&&n&&(a.locationBias=n.getCenter());const{places:l}=await google.maps.places.Place.searchByText(a);if(l&&l.length>0){const c=l[0],u=gt(c);return ue.find(d=>d.element.id===`place_marker${u.place_id}`)?(n&&u.geometry&&u.geometry.location&&(n.setCenter(u.geometry.location),n.setZoom(15)),We(u),JSON.stringify(u,null,2)):(Ge([u],n,ie),We(u),u.geometry&&u.geometry.location&&(mt(u,n,ie),n.setCenter(u.geometry.location),n.setZoom(15)),JSON.stringify(u,null,2))}else return`Error finding place details for '${t.location}': No results found.`}catch(a){return`Error finding place details for '${t.location}': ${a.message}`}}else if(e==="getPlaceDetailsByPlaceId"){if(!google.maps.places)return"Error: Places library not loaded.";try{const a=new google.maps.places.Place({id:t.placeId}),l=["displayName","formattedAddress","location","rating","nationalPhoneNumber"];await a.fetchFields({fields:l});const c={displayName:a.displayName,formattedAddress:a.formattedAddress,location:a.location,rating:a.rating,nationalPhoneNumber:a.nationalPhoneNumber};return c.location&&n&&n.panTo(c.location),JSON.stringify(c,null,2)}catch(a){return`Error getting place details: ${a.message}`}}else{if(e==="getDirections")return s?(!Y&&n&&(Y=new google.maps.DirectionsRenderer({map:n})),new Promise(a=>{s.route({origin:t.origin,destination:t.destination,travelMode:google.maps.TravelMode[t.travelMode||"DRIVING"]},(l,c)=>{if(c==="OK"){Y&&Y.setDirections(l);const h=l.routes[0].legs[0];a(`Directions found: ${h.distance.text} (${h.duration.text}). Start at ${h.start_address}, go to ${h.end_address}.`)}else a(`Directions request failed due to ${c}`)})})):"Error: DirectionsService not initialized.";if(e==="getElevation")return o?new Promise(a=>{const l=[{lat:t.lat,lng:t.lng}];o.getElevationForLocations({locations:l},(c,u)=>{u==="OK"&&c[0]?a(`Elevation at ${t.lat}, ${t.lng} is ${c[0].elevation.toFixed(2)} meters.`):a(`Elevation request failed: ${u}`)})}):"Error: ElevationService not initialized.";if(e==="getCurrentConditions"){const a="AIzaSyBEyMHI6C2bjOCRLnXexUgGs4e1U8bPY3I";let l=t.lat,c=t.lng;if(t.location&&(l===void 0||c===void 0)){if(!i)return"Error: Geocoder not initialized.";try{const{results:h}=await i.geocode({address:t.location});if(h&&h[0]){const d=h[0].geometry.location;l=d.lat(),c=d.lng()}else return`Error: Could not find location '${t.location}'.`}catch(h){return`Error geocoding location '${t.location}': ${h.message}`}}if(l===void 0||c===void 0)return"Error: Please provide a location name or coordinates.";n&&n.panTo({lat:l,lng:c});const u=`/weather-api/v1/currentConditions:lookup?key=${a}&location.latitude=${l}&location.longitude=${c}`;console.log("Fetching weather from:",u);try{const h=await fetch(u);if(!h.ok){let f=`Error fetching weather: ${h.status} ${h.statusText}`;try{const p=await h.json();p.error&&p.error.message&&(f=p.error.message)}catch{}return console.error("Weather API Error:",h.status,f),f}const d=await h.json();return bc(d),`Current weather displayed: ${d.temperature.degrees} ${d.temperature.unit}, ${d.weatherCondition.description.text}.`}catch(h){return console.error("Weather Fetch Exception:",h),`Error fetching weather: ${h.message}`}}else if(e==="getDailyForecast"){const a="AIzaSyBEyMHI6C2bjOCRLnXexUgGs4e1U8bPY3I";let l=t.lat,c=t.lng;if(t.location&&(l===void 0||c===void 0)){if(!i)return"Error: Geocoder not initialized.";try{const{results:h}=await i.geocode({address:t.location});if(h&&h[0]){const d=h[0].geometry.location;l=d.lat(),c=d.lng()}else return`Error: Could not find location '${t.location}'.`}catch(h){return`Error geocoding location '${t.location}': ${h.message}`}}if(l===void 0||c===void 0)return"Error: Please provide a location name or coordinates.";n&&n.panTo({lat:l,lng:c});const u=`/weather-api/v1/forecast/days:lookup?key=${a}&location.latitude=${l}&location.longitude=${c}`;console.log("Fetching forecast from:",u);try{const h=await fetch(u);if(!h.ok){let f=`Error fetching forecast: ${h.status} ${h.statusText}`;try{const p=await h.json();p.error&&p.error.message&&(f=p.error.message)}catch{}return console.error("Weather API Error:",h.status,f),f}const d=await h.json();return _c(d),`7-day forecast displayed for ${t.location||l+","+c}.`}catch(h){return console.error("Weather Fetch Exception:",h),`Error fetching forecast: ${h.message}`}}else if(e==="closeWeatherInfo"){const a=document.getElementById("weather-panel");return a?(a.style.display="none","Weather panel closed."):"Weather panel is not open."}else if(e==="clearMarkers")return pt(),Y&&(Y.setMap(null),Y=null),K&&K.setMap(null),J&&J.setMap(null),"Successfully cleared all markers, directions, traffic, and transit layers from the map."}}}return`Error: Unknown tool command '${e}'.`}function Tc(e,t){const n=document.createElement("button");n.classList.add("agent-control"),n.title="Start Live Chat";const i=document.createElement("span");i.classList.add("material-symbols-outlined"),i.style.fontSize="24px",i.style.color="#5f6368",i.textContent="mic",n.appendChild(i);let r=!1;n.addEventListener("click",()=>{r=!r,t(r),s(r)});function s(o){o?(i.textContent="graphic_eq",i.style.color="#ea4335",i.style.animation="pulse 1.5s infinite"):(i.textContent="mic",i.style.color="#5f6368",i.style.animation="none")}return n.setLiveState=o=>{r=o,s(o)},n}class Sc{constructor({mapState:t,onActiveChange:n}){this.mapState=t,this.onActiveChange=n,this.ws=null,this.audioContext=null,this.mediaStream=null,this.workletNode=null,this.isPlaying=!1,this.audioQueue=[],this.nextPlayTime=0,this.isActive=!1}async connect(){const i="wss://generativelanguage.googleapis.com/ws/google.ai.generativelanguage.v1alpha.GenerativeService.BidiGenerateContent?key=AIzaSyBEyMHI6C2bjOCRLnXexUgGs4e1U8bPY3I";this.ws=new WebSocket(i),this.ws.onopen=()=>{console.log("Gemini Live WebSocket connected"),this.isActive=!0,this.onActiveChange(!0),this.sendInitialSetup(),setTimeout(()=>this.sendWelcomePrompt(),100)},this.ws.onmessage=async r=>{await this.handleMessage(r.data)},this.ws.onclose=r=>{console.log("Gemini Live WebSocket disconnected",r.code,r.reason),this.isActive=!1,this.onActiveChange(!1),this.stopAudio()},this.ws.onerror=r=>{console.error("WebSocket error:",r)},await this.startAudioInput()}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.stopAudio()}sendInitialSetup(){const t={setup:{model:"models/gemini-2.5-flash-native-audio-preview-12-2025",tools:[{functionDeclarations:[...ar,...lr,...cr]}],generationConfig:{responseModalities:["AUDIO"]}}};this.send(t)}sendWelcomePrompt(){const t={clientContent:{turns:[{role:"user",parts:[{text:"Please say hello and tell me you can move the map, zoom, search for places and give directions."}]}],turnComplete:!0}};this.send(t)}send(t){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(t))}async handleMessage(t){let n;try{t instanceof Blob?n=JSON.parse(await t.text()):n=JSON.parse(t)}catch(i){console.error("Error parsing message:",i);return}if(n.serverContent?.modelTurn?.parts)for(const i of n.serverContent.modelTurn.parts){if(i.inlineData&&i.inlineData.mimeType.startsWith("audio/")){const r=this.base64ToArrayBuffer(i.inlineData.data);this.playAudioChunk(r)}i.text&&G(i.text,!1)}n.toolCall&&await this.handleToolCall(n.toolCall)}async handleToolCall(t){const n=t.functionCalls,i=[];for(const s of n){console.log("Live Tool Call:",s.name,s.args);const o=await Ur(s.name,s.args,this.mapState.map,this.mapState.geocoder,this.mapState.panorama,this.mapState.directionsService,this.mapState.elevationService);i.push({id:s.id,name:s.name,response:{result:typeof o=="object"?JSON.stringify(o):o}})}const r={toolResponse:{functionResponses:i}};this.send(r)}async startAudioInput(){this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),this.mediaStream=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:16e3}});const t=this.audioContext.createMediaStreamSource(this.mediaStream);console.log("Loading AudioWorklet module...");try{await this.audioContext.audioWorklet.addModule("pcm-processor.js"),console.log("AudioWorklet module loaded.")}catch(i){throw console.error("Failed to load AudioWorklet module:",i),i}const n=new AudioWorkletNode(this.audioContext,"pcm-processor");n.port.onmessage=i=>{if(!this.isActive)return;const r=i.data,s=this.floatTo16BitPCM(r),o=this.arrayBufferToBase64(s);this.send({realtimeInput:{mediaChunks:[{mimeType:"audio/pcm;rate=16000",data:o}]}})},t.connect(n),n.connect(this.audioContext.destination),this.workletNode=n}stopAudio(){this.mediaStream&&(this.mediaStream.getTracks().forEach(t=>t.stop()),this.mediaStream=null),this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null)}async playAudioChunk(t){if(!this.audioContext)return;const n=this.pcm16ToFloat32(t),i=this.audioContext.createBuffer(1,n.length,24e3);i.getChannelData(0).set(n);const r=this.audioContext.createBufferSource();r.buffer=i,r.connect(this.audioContext.destination);const s=this.audioContext.currentTime,o=Math.max(s,this.nextPlayTime);r.start(o),this.nextPlayTime=o+i.duration}floatTo16BitPCM(t){const n=new ArrayBuffer(t.length*2),i=new DataView(n);for(let r=0;r<t.length;r++){let s=Math.max(-1,Math.min(1,t[r]));s=s<0?s*32768:s*32767,i.setInt16(r*2,s,!0)}return n}pcm16ToFloat32(t){const n=new DataView(t),i=new Float32Array(t.byteLength/2);for(let r=0;r<i.length;r++){const s=n.getInt16(r*2,!0);i[r]=s/32768}return i}arrayBufferToBase64(t){let n="";const i=new Uint8Array(t),r=i.byteLength;for(let s=0;s<r;s++)n+=String.fromCharCode(i[s]);return btoa(n)}base64ToArrayBuffer(t){const n=atob(t),i=n.length,r=new Uint8Array(i);for(let s=0;s<i;s++)r[s]=n.charCodeAt(s);return r.buffer}}let q={map:null,geocoder:null,panorama:null,directionsService:null,elevationService:null},yt=null,ze=null;async function Cc(e){const t=xs();try{const i=await(await t.sendMessage(e)).response,r=i.functionCalls();if(r&&r.length>0)for(const s of r){const o=await Ur(s.name,s.args,q.map,q.geocoder,q.panorama,q.directionsService,q.elevationService),a=[{functionResponse:{name:s.name,response:{name:s.name,content:o}}}],l=await t.sendMessage(a);G(l.response.text())}else G(i.text())}catch(n){console.error("Gemini Error:",n),G("Sorry, I encountered an error processing your request.")}}async function Rc(){const e=await Gi();if(e){q=e,zi(Cc),ur(),yt=new Sc({mapState:q,onActiveChange:i=>{ze&&ze.setLiveState(i),G(i?"Started Live Session 🎙️":"Ended Live Session",!1)}}),ze=Tc(q.map,i=>{i?yt.connect():yt.disconnect()}),q.map.controls[google.maps.ControlPosition.INLINE_END_BLOCK_END].push(ze);const t=vs();document.querySelector(".app-container").appendChild(t);const n=kc();document.querySelector(".app-container").appendChild(n),G("Hello! I'm your AI Map Agent. I can move the map, zoom, search for places, and give directions. Try saying 'Go to Paris' or 'Find pizza nearby'.")}}Rc();
