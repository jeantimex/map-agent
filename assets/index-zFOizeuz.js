(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();function ce(e,t){e.src=t}const le=e=>{var t,n,i,o="The Google Maps JavaScript API",s="google",r="importLibrary",a="__ib__",l=document,p=window,E=p[s]||(p[s]={}),h=E.maps||(E.maps={}),d=new Set,c=new URLSearchParams,u=()=>t||(t=new Promise(async(g,N)=>{await(n=l.createElement("script")),c.set("libraries",[...d]+"");for(i in e)c.set(i.replace(/[A-Z]/g,ae=>"_"+ae[0].toLowerCase()),e[i]);c.set("callback",s+".maps."+a),ce(n,"https://maps.googleapis.com/maps/api/js?"+c),h[a]=g,n.onerror=()=>t=N(Error(o+" could not load.")),n.nonce=l.querySelector("script[nonce]")?.nonce||"",l.head.append(n)}));h[r]?console.warn(o+" only loads once. Ignoring:",e):h[r]=(g,...N)=>d.add(g)&&u().then(()=>h[r](g,...N))},de=e=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(e)}) will be ignored.`,ue=e=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(e)}) will be ignored.`,fe=()=>{},pe=()=>{};let G=!1;function he(e){if(G){fe(de(e));return}ge(e),G=!0}async function M(e){if(!window?.google?.maps?.importLibrary)throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(e)}function ge(e){const t=!!window.google?.maps?.importLibrary;t&&pe(ue(e)),t||le(e)}var B;(function(e){e.STRING="string",e.NUMBER="number",e.INTEGER="integer",e.BOOLEAN="boolean",e.ARRAY="array",e.OBJECT="object"})(B||(B={}));var D;(function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"})(D||(D={}));var U;(function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(U||(U={}));const $=["user","model","function","system"];var P;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(P||(P={}));var H;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(H||(H={}));var F;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(F||(F={}));var j;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"})(j||(j={}));var T;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.OTHER="OTHER"})(T||(T={}));var q;(function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"})(q||(q={}));var K;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(K||(K={}));var k;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(k||(k={}));class f extends Error{constructor(t){super(`[GoogleGenerativeAI Error]: ${t}`)}}class _ extends f{constructor(t,n){super(t),this.response=n}}class Q extends f{constructor(t,n,i,o){super(t),this.status=n,this.statusText=i,this.errorDetails=o}}class y extends f{}class ee extends f{}const Ee="https://generativelanguage.googleapis.com",me="v1beta",ye="0.24.1",Ce="genai-js";var C;(function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"})(C||(C={}));class _e{constructor(t,n,i,o,s){this.model=t,this.task=n,this.apiKey=i,this.stream=o,this.requestOptions=s}toString(){var t,n;const i=((t=this.requestOptions)===null||t===void 0?void 0:t.apiVersion)||me;let s=`${((n=this.requestOptions)===null||n===void 0?void 0:n.baseUrl)||Ee}/${i}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}function ve(e){const t=[];return e?.apiClient&&t.push(e.apiClient),t.push(`${Ce}/${ye}`),t.join(" ")}async function Ie(e){var t;const n=new Headers;n.append("Content-Type","application/json"),n.append("x-goog-api-client",ve(e.requestOptions)),n.append("x-goog-api-key",e.apiKey);let i=(t=e.requestOptions)===null||t===void 0?void 0:t.customHeaders;if(i){if(!(i instanceof Headers))try{i=new Headers(i)}catch(o){throw new y(`unable to convert customHeaders value ${JSON.stringify(i)} to Headers: ${o.message}`)}for(const[o,s]of i.entries()){if(o==="x-goog-api-key")throw new y(`Cannot set reserved header name ${o}`);if(o==="x-goog-api-client")throw new y(`Header name ${o} can only be set using the apiClient field`);n.append(o,s)}}return n}async function Oe(e,t,n,i,o,s){const r=new _e(e,t,n,i,s);return{url:r.toString(),fetchOptions:Object.assign(Object.assign({},we(s)),{method:"POST",headers:await Ie(r),body:o})}}async function w(e,t,n,i,o,s={},r=fetch){const{url:a,fetchOptions:l}=await Oe(e,t,n,i,o,s);return Te(a,l,r)}async function Te(e,t,n=fetch){let i;try{i=await n(e,t)}catch(o){Re(o,e)}return i.ok||await Se(i,e),i}function Re(e,t){let n=e;throw n.name==="AbortError"?(n=new ee(`Request aborted when fetching ${t.toString()}: ${e.message}`),n.stack=e.stack):e instanceof Q||e instanceof y||(n=new f(`Error fetching from ${t.toString()}: ${e.message}`),n.stack=e.stack),n}async function Se(e,t){let n="",i;try{const o=await e.json();n=o.error.message,o.error.details&&(n+=` ${JSON.stringify(o.error.details)}`,i=o.error.details)}catch{}throw new Q(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,i)}function we(e){const t={};if(e?.signal!==void 0||e?.timeout>=0){const n=new AbortController;e?.timeout>=0&&setTimeout(()=>n.abort(),e.timeout),e?.signal&&e.signal.addEventListener("abort",()=>{n.abort()}),t.signal=n.signal}return t}function x(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),A(e.candidates[0]))throw new _(`${m(e)}`,e);return Ae(e)}else if(e.promptFeedback)throw new _(`Text not available. ${m(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),A(e.candidates[0]))throw new _(`${m(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Y(e)[0]}else if(e.promptFeedback)throw new _(`Function call not available. ${m(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),A(e.candidates[0]))throw new _(`${m(e)}`,e);return Y(e)}else if(e.promptFeedback)throw new _(`Function call not available. ${m(e)}`,e)},e}function Ae(e){var t,n,i,o;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const r of(o=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||o===void 0?void 0:o.parts)r.text&&s.push(r.text),r.executableCode&&s.push("\n```"+r.executableCode.language+`
`+r.executableCode.code+"\n```\n"),r.codeExecutionResult&&s.push("\n```\n"+r.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function Y(e){var t,n,i,o;const s=[];if(!((n=(t=e.candidates)===null||t===void 0?void 0:t[0].content)===null||n===void 0)&&n.parts)for(const r of(o=(i=e.candidates)===null||i===void 0?void 0:i[0].content)===null||o===void 0?void 0:o.parts)r.functionCall&&s.push(r.functionCall);if(s.length>0)return s}const Ne=[T.RECITATION,T.SAFETY,T.LANGUAGE];function A(e){return!!e.finishReason&&Ne.includes(e.finishReason)}function m(e){var t,n,i;let o="";if((!e.candidates||e.candidates.length===0)&&e.promptFeedback)o+="Response was blocked",!((t=e.promptFeedback)===null||t===void 0)&&t.blockReason&&(o+=` due to ${e.promptFeedback.blockReason}`),!((n=e.promptFeedback)===null||n===void 0)&&n.blockReasonMessage&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);else if(!((i=e.candidates)===null||i===void 0)&&i[0]){const s=e.candidates[0];A(s)&&(o+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(o+=`: ${s.finishMessage}`))}return o}function R(e){return this instanceof R?(this.v=e,this):new R(e)}function Me(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(e,t||[]),o,s=[];return o={},r("next"),r("throw"),r("return"),o[Symbol.asyncIterator]=function(){return this},o;function r(d){i[d]&&(o[d]=function(c){return new Promise(function(u,g){s.push([d,c,u,g])>1||a(d,c)})})}function a(d,c){try{l(i[d](c))}catch(u){h(s[0][3],u)}}function l(d){d.value instanceof R?Promise.resolve(d.value.v).then(p,E):h(s[0][2],d)}function p(d){a("next",d)}function E(d){a("throw",d)}function h(d,c){d(c),s.shift(),s.length&&a(s[0][0],s[0][1])}}const V=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function be(e){const t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),n=Ge(t),[i,o]=n.tee();return{stream:xe(i),response:Le(o)}}async function Le(e){const t=[],n=e.getReader();for(;;){const{done:i,value:o}=await n.read();if(i)return x(Be(t));t.push(o)}}function xe(e){return Me(this,arguments,function*(){const n=e.getReader();for(;;){const{value:i,done:o}=yield R(n.read());if(o)break;yield yield R(x(i))}})}function Ge(e){const t=e.getReader();return new ReadableStream({start(i){let o="";return s();function s(){return t.read().then(({value:r,done:a})=>{if(a){if(o.trim()){i.error(new f("Failed to parse stream"));return}i.close();return}o+=r;let l=o.match(V),p;for(;l;){try{p=JSON.parse(l[1])}catch{i.error(new f(`Error parsing JSON response: "${l[1]}"`));return}i.enqueue(p),o=o.substring(l[0].length),l=o.match(V)}return s()}).catch(r=>{let a=r;throw a.stack=r.stack,a.name==="AbortError"?a=new ee("Request aborted when reading from the stream"):a=new f("Error reading from the stream"),a})}}})}function Be(e){const t=e[e.length-1],n={promptFeedback:t?.promptFeedback};for(const i of e){if(i.candidates){let o=0;for(const s of i.candidates)if(n.candidates||(n.candidates=[]),n.candidates[o]||(n.candidates[o]={index:o}),n.candidates[o].citationMetadata=s.citationMetadata,n.candidates[o].groundingMetadata=s.groundingMetadata,n.candidates[o].finishReason=s.finishReason,n.candidates[o].finishMessage=s.finishMessage,n.candidates[o].safetyRatings=s.safetyRatings,s.content&&s.content.parts){n.candidates[o].content||(n.candidates[o].content={role:s.content.role||"user",parts:[]});const r={};for(const a of s.content.parts)a.text&&(r.text=a.text),a.functionCall&&(r.functionCall=a.functionCall),a.executableCode&&(r.executableCode=a.executableCode),a.codeExecutionResult&&(r.codeExecutionResult=a.codeExecutionResult),Object.keys(r).length===0&&(r.text=""),n.candidates[o].content.parts.push(r)}o++}i.usageMetadata&&(n.usageMetadata=i.usageMetadata)}return n}async function te(e,t,n,i){const o=await w(t,C.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(n),i);return be(o)}async function ne(e,t,n,i){const s=await(await w(t,C.GENERATE_CONTENT,e,!1,JSON.stringify(n),i)).json();return{response:x(s)}}function oe(e){if(e!=null){if(typeof e=="string")return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function S(e){let t=[];if(typeof e=="string")t=[{text:e}];else for(const n of e)typeof n=="string"?t.push({text:n}):t.push(n);return De(t)}function De(e){const t={role:"user",parts:[]},n={role:"function",parts:[]};let i=!1,o=!1;for(const s of e)"functionResponse"in s?(n.parts.push(s),o=!0):(t.parts.push(s),i=!0);if(i&&o)throw new f("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!i&&!o)throw new f("No content is provided for sending chat message.");return i?t:n}function Ue(e,t){var n;let i={model:t?.model,generationConfig:t?.generationConfig,safetySettings:t?.safetySettings,tools:t?.tools,toolConfig:t?.toolConfig,systemInstruction:t?.systemInstruction,cachedContent:(n=t?.cachedContent)===null||n===void 0?void 0:n.name,contents:[]};const o=e.generateContentRequest!=null;if(e.contents){if(o)throw new y("CountTokensRequest must have one of contents or generateContentRequest, not both.");i.contents=e.contents}else if(o)i=Object.assign(Object.assign({},i),e.generateContentRequest);else{const s=S(e);i.contents=[s]}return{generateContentRequest:i}}function J(e){let t;return e.contents?t=e:t={contents:[S(e)]},e.systemInstruction&&(t.systemInstruction=oe(e.systemInstruction)),t}function $e(e){return typeof e=="string"||Array.isArray(e)?{content:S(e)}:e}const z=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Pe={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function He(e){let t=!1;for(const n of e){const{role:i,parts:o}=n;if(!t&&i!=="user")throw new f(`First content should be with role 'user', got ${i}`);if(!$.includes(i))throw new f(`Each item should include role field. Got ${i} but valid roles are: ${JSON.stringify($)}`);if(!Array.isArray(o))throw new f("Content should have 'parts' property with an array of Parts");if(o.length===0)throw new f("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const a of o)for(const l of z)l in a&&(s[l]+=1);const r=Pe[i];for(const a of z)if(!r.includes(a)&&s[a]>0)throw new f(`Content with role '${i}' can't contain '${a}' part`);t=!0}}function W(e){var t;if(e.candidates===void 0||e.candidates.length===0)return!1;const n=(t=e.candidates[0])===null||t===void 0?void 0:t.content;if(n===void 0||n.parts===void 0||n.parts.length===0)return!1;for(const i of n.parts)if(i===void 0||Object.keys(i).length===0||i.text!==void 0&&i.text==="")return!1;return!0}const X="SILENT_ERROR";class Fe{constructor(t,n,i,o={}){this.model=n,this.params=i,this._requestOptions=o,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=t,i?.history&&(He(i.history),this._history=i.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(t,n={}){var i,o,s,r,a,l;await this._sendPromise;const p=S(t),E={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,p]},h=Object.assign(Object.assign({},this._requestOptions),n);let d;return this._sendPromise=this._sendPromise.then(()=>ne(this._apiKey,this.model,E,h)).then(c=>{var u;if(W(c.response)){this._history.push(p);const g=Object.assign({parts:[],role:"model"},(u=c.response.candidates)===null||u===void 0?void 0:u[0].content);this._history.push(g)}else{const g=m(c.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}d=c}).catch(c=>{throw this._sendPromise=Promise.resolve(),c}),await this._sendPromise,d}async sendMessageStream(t,n={}){var i,o,s,r,a,l;await this._sendPromise;const p=S(t),E={safetySettings:(i=this.params)===null||i===void 0?void 0:i.safetySettings,generationConfig:(o=this.params)===null||o===void 0?void 0:o.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(r=this.params)===null||r===void 0?void 0:r.toolConfig,systemInstruction:(a=this.params)===null||a===void 0?void 0:a.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,p]},h=Object.assign(Object.assign({},this._requestOptions),n),d=te(this._apiKey,this.model,E,h);return this._sendPromise=this._sendPromise.then(()=>d).catch(c=>{throw new Error(X)}).then(c=>c.response).then(c=>{if(W(c)){this._history.push(p);const u=Object.assign({},c.candidates[0].content);u.role||(u.role="model"),this._history.push(u)}else{const u=m(c);u&&console.warn(`sendMessageStream() was unsuccessful. ${u}. Inspect response object for details.`)}}).catch(c=>{c.message!==X&&console.error(c)}),d}}async function je(e,t,n,i){return(await w(t,C.COUNT_TOKENS,e,!1,JSON.stringify(n),i)).json()}async function qe(e,t,n,i){return(await w(t,C.EMBED_CONTENT,e,!1,JSON.stringify(n),i)).json()}async function Ke(e,t,n,i){const o=n.requests.map(r=>Object.assign(Object.assign({},r),{model:t}));return(await w(t,C.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:o}),i)).json()}class Z{constructor(t,n,i={}){this.apiKey=t,this._requestOptions=i,n.model.includes("/")?this.model=n.model:this.model=`models/${n.model}`,this.generationConfig=n.generationConfig||{},this.safetySettings=n.safetySettings||[],this.tools=n.tools,this.toolConfig=n.toolConfig,this.systemInstruction=oe(n.systemInstruction),this.cachedContent=n.cachedContent}async generateContent(t,n={}){var i;const o=J(t),s=Object.assign(Object.assign({},this._requestOptions),n);return ne(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},o),s)}async generateContentStream(t,n={}){var i;const o=J(t),s=Object.assign(Object.assign({},this._requestOptions),n);return te(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},o),s)}startChat(t){var n;return new Fe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},t),this._requestOptions)}async countTokens(t,n={}){const i=Ue(t,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),o=Object.assign(Object.assign({},this._requestOptions),n);return je(this.apiKey,this.model,i,o)}async embedContent(t,n={}){const i=$e(t),o=Object.assign(Object.assign({},this._requestOptions),n);return qe(this.apiKey,this.model,i,o)}async batchEmbedContents(t,n={}){const i=Object.assign(Object.assign({},this._requestOptions),n);return Ke(this.apiKey,this.model,t,i)}}class ke{constructor(t){this.apiKey=t}getGenerativeModel(t,n){if(!t.model)throw new f("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Z(this.apiKey,t,n)}getGenerativeModelFromCachedContent(t,n,i){if(!t.name)throw new y("Cached content must contain a `name` field.");if(!t.model)throw new y("Cached content must contain a `model` field.");const o=["model","systemInstruction"];for(const r of o)if(n?.[r]&&t[r]&&n?.[r]!==t[r]){if(r==="model"){const a=n.model.startsWith("models/")?n.model.replace("models/",""):n.model,l=t.model.startsWith("models/")?t.model.replace("models/",""):t.model;if(a===l)continue}throw new y(`Different value for "${r}" specified in modelParams (${n[r]}) and cachedContent (${t[r]})`)}const s=Object.assign(Object.assign({},n),{model:t.model,tools:t.tools,toolConfig:t.toolConfig,systemInstruction:t.systemInstruction,cachedContent:t});return new Z(this.apiKey,s,i)}}const Ye=[{name:"panToLocation",description:"Moves the map center to a specific city or place by name using smooth animation.",parameters:{type:"OBJECT",properties:{locationName:{type:"STRING",description:"The name of the city or place"}},required:["locationName"]}},{name:"panToCoordinates",description:"Moves the map center to specific latitude and longitude coordinates using smooth animation.",parameters:{type:"OBJECT",properties:{lat:{type:"NUMBER",description:"The latitude"},lng:{type:"NUMBER",description:"The longitude"}},required:["lat","lng"]}},{name:"setCenter",description:"Immediately sets the map center to specific latitude and longitude coordinates (no animation).",parameters:{type:"OBJECT",properties:{lat:{type:"NUMBER",description:"The latitude"},lng:{type:"NUMBER",description:"The longitude"}},required:["lat","lng"]}},{name:"panToBounds",description:"Pans the map to contain the given bounds (south, west, north, east). Zoom is NOT changed.",parameters:{type:"OBJECT",properties:{south:{type:"NUMBER",description:"Southern latitude"},west:{type:"NUMBER",description:"Western longitude"},north:{type:"NUMBER",description:"Northern latitude"},east:{type:"NUMBER",description:"Eastern longitude"},padding:{type:"NUMBER",description:"Padding in pixels (optional, default 0)"}},required:["south","west","north","east"]}},{name:"panBy",description:"Pans the map by the given distance in pixels (x, y). x increases east, y increases south.",parameters:{type:"OBJECT",properties:{x:{type:"NUMBER",description:"Pixels to move in x direction (positive is east)"},y:{type:"NUMBER",description:"Pixels to move in y direction (positive is south)"}},required:["x","y"]}},{name:"setHeading",description:"Sets the compass heading for the map in degrees from cardinal North.",parameters:{type:"OBJECT",properties:{heading:{type:"NUMBER",description:"The heading in degrees (0-360)"}},required:["heading"]}},{name:"setTilt",description:"Sets the angle of incidence of the map (tilt).",parameters:{type:"OBJECT",properties:{tilt:{type:"NUMBER",description:"The angle of tilt in degrees."}},required:["tilt"]}},{name:"setMapTypeId",description:"Sets the type of map to display. Allowed values: 'roadmap', 'satellite', 'hybrid', 'terrain'.",parameters:{type:"OBJECT",properties:{mapTypeId:{type:"STRING",description:"The type of map. One of: 'roadmap', 'satellite', 'hybrid', 'terrain'."}},required:["mapTypeId"]}},{name:"showStreetView",description:"Shows the Street View panorama for the current map location.",parameters:{type:"OBJECT",properties:{}}},{name:"hideStreetView",description:"Hides the Street View panorama and returns to the map view.",parameters:{type:"OBJECT",properties:{}}},{name:"zoomMap",description:"Zooms the map in or out.",parameters:{type:"OBJECT",properties:{level:{type:"NUMBER",description:"Zoom level (1-20). 1 is world view, 20 is building view."}},required:["level"]}}];async function Ve(e,t,n,i,o){if(console.log(`Executing tool: ${e}`,t),e==="panToLocation"){if(!i)return"Error: Geocoder not ready or initialized.";try{const{results:s}=await i.geocode({address:t.locationName});return s&&s[0]?(n.panTo(s[0].geometry.location),`Successfully executed map.panTo() to move map to ${t.locationName}`):`Error: Could not find location '${t.locationName}'. Please check the spelling.`}catch(s){return console.error("Geocoding failed",s),`Error: Geocoding failed for '${t.locationName}'. Reason: ${s.message}`}}else{if(e==="panToCoordinates")return n?(n.panTo({lat:t.lat,lng:t.lng}),`Successfully executed map.panTo() to move map to coordinates: ${t.lat}, ${t.lng}`):"Error: Map not initialized.";if(e==="setCenter")return n?(n.setCenter({lat:t.lat,lng:t.lng}),`Successfully executed map.setCenter() with coordinates: ${t.lat}, ${t.lng}`):"Error: Map not initialized.";if(e==="panToBounds"){if(!n)return"Error: Map not initialized.";const s={south:t.south,west:t.west,north:t.north,east:t.east},r=t.padding||0;return n.panToBounds(s,r),`Successfully executed map.panToBounds() with bounds: [${s.south}, ${s.west}, ${s.north}, ${s.east}] and padding: ${r}`}else{if(e==="panBy")return n?(n.panBy(t.x,t.y),`Successfully executed map.panBy(${t.x}, ${t.y})`):"Error: Map not initialized.";if(e==="setHeading")return n?(n.setHeading(t.heading),`Successfully executed map.setHeading(${t.heading})`):"Error: Map not initialized.";if(e==="setTilt")return n?(n.setTilt(t.tilt),`Successfully executed map.setTilt(${t.tilt})`):"Error: Map not initialized.";if(e==="setMapTypeId"){if(!n)return"Error: Map not initialized.";const s=["roadmap","satellite","hybrid","terrain"];return s.includes(t.mapTypeId)?(n.setMapTypeId(t.mapTypeId),`Successfully executed map.setMapTypeId('${t.mapTypeId}')`):`Error: Invalid map type '${t.mapTypeId}'. Valid types are: ${s.join(", ")}.`}else{if(e==="zoomMap")return n?(n.setZoom(t.level),`Successfully executed map.setZoom(${t.level})`):"Error: Map not initialized.";if(e==="showStreetView")return o?(document.getElementById("map-container").classList.add("split-view"),o.setPosition(n.getCenter()),o.setPov({heading:n.getHeading()||0,pitch:0}),o.setVisible(!0),n.setStreetView(o),setTimeout(()=>{google.maps.event.trigger(n,"resize")},550),"Successfully showed Street View in split mode."):"Error: Street View not initialized.";if(e==="hideStreetView")return o?(document.getElementById("map-container").classList.remove("split-view"),o.setVisible(!1),setTimeout(()=>{google.maps.event.trigger(n,"resize")},550),"Successfully hidden Street View."):"Error: Street View not initialized."}}}return`Error: Unknown tool command '${e}'.`}const Je="data:image/svg+xml,%3csvg%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2016%2016'%3e%3cpath%20d='M16%208.016A8.522%208.522%200%20008.016%2016h-.032A8.521%208.521%200%20000%208.016v-.032A8.521%208.521%200%20007.984%200h.032A8.522%208.522%200%200016%207.984v.032z'%20fill='url(%23prefix__paint0_radial_980_20147)'/%3e%3cdefs%3e%3cradialGradient%20id='prefix__paint0_radial_980_20147'%20cx='0'%20cy='0'%20r='1'%20gradientUnits='userSpaceOnUse'%20gradientTransform='matrix(16.1326%205.4553%20-43.70045%20129.2322%201.588%206.503)'%3e%3cstop%20offset='.067'%20stop-color='%239168C0'/%3e%3cstop%20offset='.343'%20stop-color='%235684D1'/%3e%3cstop%20offset='.672'%20stop-color='%231BA1E3'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e",ze="AIzaSyCS14yhKVk8MDPBbJ53CsiB8-9HZq0-TuM",We="AIzaSyCGSxQgDgzGt68PQMGDBIhpVwRrRov1uzM";he({key:ze,v:"quarterly"});let O,ie,se,L;const Xe=new ke(We),Ze=Xe.getGenerativeModel({model:"gemini-3-flash-preview",tools:[{functionDeclarations:Ye}]});function Qe(e){const t=document.createElement("button");t.classList.add("agent-control"),t.title="Reset Heading & Tilt";const n=document.createElement("img");return n.src=Je,n.classList.add("agent-icon"),t.appendChild(n),t.addEventListener("click",()=>{const i=document.querySelector(".chat-container");i.classList.toggle("open"),i.classList.contains("open")&&setTimeout(()=>document.getElementById("chat-input").focus(),300)}),t}async function et(){const e=document.getElementById("map");if(e)try{const{Map:t}=await M("maps"),{Geocoder:n}=await M("geocoding"),{StreetViewPanorama:i}=await M("streetView");ie=new n;const o={lat:37.7749,lng:-122.4194};O=new t(e,{center:o,zoom:12,renderingType:"VECTOR",disableDefaultUI:!0,streetViewControl:!0,tiltInteractionEnabled:!0,headingInteractionEnabled:!0}),se=new i(document.getElementById("pano"),{position:o,visible:!1,pov:{heading:0,pitch:0}});const s=Qe(O);O.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(s),O.addListener("click",()=>{document.querySelector(".chat-container").classList.remove("open")}),document.getElementById("close-chat").addEventListener("click",()=>{document.querySelector(".chat-container").classList.remove("open")}),L=Ze.startChat(),I("Hello! I'm your AI Map Agent. I can move the map and zoom for you. Try saying 'Go to Paris' or 'Zoom in'.")}catch(t){console.error("Error loading Google Maps API:",t),I("Error loading Maps. Please check your API key.",!1)}}et();const v=document.getElementById("chat-input"),tt=document.getElementById("send-btn"),b=document.getElementById("chat-messages");function I(e,t=!1){if(!e||!e.trim())return;const n=document.createElement("div");n.className=`message ${t?"user":"system"}`,n.textContent=e,b.appendChild(n),b.scrollTop=b.scrollHeight}async function re(){const e=v.value.trim();if(e){I(e,!0),v.value="",v.disabled=!0;try{const n=await(await L.sendMessage(e)).response,i=n.functionCalls();if(i&&i.length>0)for(const o of i){const s=await Ve(o.name,o.args,O,ie,se),r=[{functionResponse:{name:o.name,response:{name:o.name,content:s}}}],a=await L.sendMessage(r);I(a.response.text())}else I(n.text())}catch(t){console.error("Gemini Error:",t),I("Sorry, I encountered an error processing your request.")}finally{v.disabled=!1,v.focus()}}}tt.addEventListener("click",re);v.addEventListener("keypress",e=>{e.key==="Enter"&&re()});
